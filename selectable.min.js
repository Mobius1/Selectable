/*!
 *
 * Selectable
 * Copyright (c) 2017 Karl Saunders (http://mobius.ovh)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 0.10.9
 *
 */
!function(t,e){var s="Selectable";"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define([],e):t[s]=e()}("undefined"!=typeof global?global:this.window||this.global,function(){"use strict";var s="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,i="classList"in document.documentElement,e=function(t,e,s,i){t.addEventListener(e,s,!1)},n=function(t,e,s){t.removeEventListener(e,s)},h=function(t,e){return t&&t!==document.documentElement&&(e(t)?t:h(t.parentNode,e))},o=function(t){return"[object Object]"===Object.prototype.toString.call(t)},c=function(t){return Array.isArray(t)||t instanceof HTMLCollection||t instanceof NodeList},l=function(t,e){for(var s in e)if(e.hasOwnProperty(s)){var i=e[s];i&&o(i)?(t[s]=t[s]||{},l(t[s],i)):t[s]=i}return t},d=function(t,e,s){var i;if(o(t))for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(s,t[i],i);else for(i=0;i<t.length;i++)e.call(s,t[i],i)},a=function(s,t){var i=s.style;if(s){if(void 0===t)return window.getComputedStyle(s);o(t)&&d(t,function(t,e){e in i||(e="-webkit-"+e),s.style[e]=t+("string"==typeof t?"":"opacity"===e?"":"px")})}},r=function(t){var e=window,s=t.getBoundingClientRect(),i=document.documentElement||document.body.parentNode||document.body,n=void 0!==e.pageXOffset?e.pageXOffset:i.scrollLeft,o=void 0!==e.pageYOffset?e.pageYOffset:i.scrollTop;return{x1:s.left+n,x2:s.left+s.width+n,y1:s.top+o,y2:s.top+s.height+o,height:s.height,width:s.width}},u=function(t,e,s){var i;return function(){if(s=s||this,!i)return t.apply(s,arguments),i=!0,setTimeout(function(){i=!1},e)}},f={add:function(t,e){i?t.classList.add(e):f.contains(t,e)||(t.className=t.className.trim()+" "+e)},remove:function(t,e){i?t.classList.remove(e):f.contains(t,e)&&(t.className=t.className.replace(new RegExp("(^|\\s)"+e.split(" ").join("|")+"(\\s|$)","gi")," "))},contains:function(t,e){if(t)return i?t.classList.contains(e):!!t.className&&!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))}},g=function(t){return!!t.ctrlKey||!!t.metaKey},m=function(t){return!!t.shiftKey};function t(t){var e={toggle:!1,autoRefresh:!0,throttle:50,appendTo:document.body,filter:".ui-selectable",tolerance:"touch",autoScroll:{offset:40,increment:10},lasso:{border:"1px dotted #000",backgroundColor:"rgba(52, 152, 219, 0.2)"},classes:{lasso:"ui-lasso",selected:"ui-selected",container:"ui-container",selecting:"ui-selecting",selectable:"ui-selectable",unselecting:"ui-unselecting"}};this.version="0.10.9",this.config=l(e,t),this.init()}return t.prototype={init:function(){var t=this,e=this.config;this.autoscroll=o(e.autoScroll),this.data={x:0,y:0,right:0,left:0,down:0,up:0},this.lasso=!1,e.lasso&&o(e.lasso)&&(this.lasso=document.createElement("div"),this.lasso.className=e.classes.lasso,a(this.lasso,l({position:"fixed",opacity:0},e.lasso))),s&&(e.toggle=!1),this.events={start:this.start.bind(this),touchstart:this.touchstart.bind(this),drag:this.drag.bind(this),end:this.end.bind(this),keyup:this.keyup.bind(this),keydown:this.keydown.bind(this),recalculate:u(this.recalculate,e.throttle,this)},this.autoscroll&&(this.events.scroll=u(this.scroll,e.throttle,this)),this.setContainer(),this.update(),this.enable(),setTimeout(function(){t.emit("selectable.init")},10)},update:function(){var s=this.config.classes,i=f.contains;this.size={rect:r(this.container),x:this.container.scrollLeft,y:this.container.scrollTop,w:this.container.scrollWidth,h:this.container.scrollHeight},this.items=[],d(this.nodes,function(t,e){f.add(t,s.selectable),this.items[e]={node:t,rect:r(t),startselected:!1,selected:i(t,s.selected),selecting:i(t,s.selecting),unselecting:i(t,s.unselecting)}},this),this.emit("selectable.update",this.items)},bind:function(){var t=this.events;s?(e(this.container,"touchstart",t.touchstart),e(document,"touchend",t.end),e(document,"touchcancel",t.end),!1!==this.lasso&&e(document,"touchmove",t.drag)):(e(this.container,"mousedown",t.start),e(document,"mouseup",t.end),e(document,"keydown",t.keydown),e(document,"keyup",t.keyup),!1!==this.lasso&&e(document,"mousemove",t.drag)),this.autoscroll&&e(this.container,"scroll",t.scroll),e(window,"resize",t.recalculate),e(window,"scroll",t.recalculate)},unbind:function(){var t=this.events;n(this.container,"mousedown",t.start),n(document,"mousemove",t.drag),n(document,"mouseup",t.end),n(document,"keydown",t.keydown),n(document,"keyup",t.keyup),this.autoscroll&&n(this.container,"scroll",t.scroll),n(this.container,"touchstart",t.start),n(document,"touchend",t.end),n(document,"touchcancel",t.end),n(document,"touchmove",t.drag),n(window,"resize",t.recalculate),n(window,"scroll",t.recalculate)},touchstart:function(t){n(this.container,"mousedown",this.events.start),this.start(t)},start:function(i){if(this.container.contains(i.target)&&3!==i.which&&!(0<i.button)){var n,e=this,o=this.config,c=h(i.target,function(t){return t===e.container||f.contains(t,o.classes.selectable)});if(!c||o.disabled)return!1;-1===["INPUT","SELECT","BUTTON","TEXTAREA","OPTION"].indexOf(i.target.tagName)&&i.preventDefault();var l="touchstart"===i.type;if(this.dragging=!0,this.origin={x:l?i.touches[0].pageX:i.pageX,y:l?i.touches[0].pageY:i.pageY},this.autoscroll&&(this.origin.scroll={x:this.container.scrollLeft,y:this.container.scrollTop}),this.lasso&&this.container.appendChild(this.lasso),c!==this.container&&f.add(c,o.classes.selecting),o.autoRefresh&&this.update(),m(i)&&this.startEl)for(var t=this.items,s=this.getNodes().indexOf(c),a=this.getNodes().indexOf(this.startEl),r=s<a?1:-1;(s+=r)&&s!==a;)t[s].selecting=!0;d(this.items,function(t){var e=t.node,s=e===c;if(t.selected){t.startselected=!0;(l||o.toggle||g(i)?s:!s&&!m(i))&&(f.remove(e,o.classes.selected),t.selected=!1,f.add(e,o.classes.unselecting),t.unselecting=!0)}s&&(n=t)}),this.startEl=c,this.emit("selectable.start",i,n)}},drag:function(e){if(!this.config.disabled&&this.dragging&&!m(e)){var t,s,i=this,n="touchmove"===e.type;this.offset=t={x1:this.origin.x,y1:this.origin.y,x2:n?e.touches[0].pageX:e.pageX,y2:n?e.touches[0].pageY:e.pageY,scroll:{x:0,y:0}},this.autoscroll&&(t.scroll={x:this.container.scrollLeft,y:this.container.scrollTop},this.scrolling={x:0,y:0},this.autoScroll(e)),t.x1>t.x2&&(s=t.x2,t.x2=t.x1,t.x1=s),t.y1>t.y2&&(s=t.y2,t.y2=t.y1,t.y1=s),d(this.items,function(t){i.highlight(t,g(e))});var o={x1:t.x1+this.data.right,x2:t.x2+this.data.left-(t.x1+this.data.right),y1:t.y1+this.data.down,y2:t.y2+this.data.up-(t.y1+this.data.down)};this.lasso&&this.updateHelper(o),this.emit("selectable.drag",e,o)}},end:function(t){if(this.dragging){this.dragging=!1;var e,s=this,i=s.config,n=t.target,o=[],c=[],l="touchend"===t.type?t.touches[0]||t.changedTouches[0]:t;this.lasso&&this.container.contains(this.lasso)&&this.container.removeChild(this.lasso),this.lasso&&(a(this.lasso,{opacity:0,left:0,width:0,top:0,height:0}),n=document.elementFromPoint(l.pageX,l.pageY)),e=h(n,function(t){return f.contains(t,i.classes.selectable)}),this.data.right=0,this.data.left=0,this.data.down=0,this.data.up=0,d(this.items,function(t){i.toggle&&t.node===e&&t.node===s.startEl&&t.selecting&&t.startselected&&(t.unselecting=!0,t.selecting=!1),t.unselecting&&(c.push(t),this.unselect(t)),t.selecting&&(o.push(t),this.select(t))},this),this.emit("selectable.end",t,o,c)}},keydown:function(t){if(this.cmdDown=g(t),this.shiftDown=m(t),this.cmdDown){var e=t.code||t.keyCode;65!=e&&97!=e||(t.preventDefault(),this.selectAll())}},keyup:function(t){this.cmdDown=g(t),this.shiftDown=m(t)},scroll:function(t){d(this.items,function(t){t.rect=r(t.node)})},updateHelper:function(t){var e={opacity:1,left:t.x1,width:t.x2,top:t.y1,height:t.y2};this.autoscroll&&(e=l(e,{zIndex:0,position:"absolute",left:t.x1-this.size.rect.x1+this.offset.scroll.x,top:t.y1-this.size.rect.y1+this.offset.scroll.y})),a(this.lasso,e)},autoScroll:function(t){var e=this.config.autoScroll,s=this.size.rect,i=this.offset.scroll.x,n=this.offset.scroll.y,o=this.size.w,c=this.size.h,l=0,a=0,r=i,h=n;(0<n||n<c-s.height)&&(t.pageY>=s.y2-e.offset||t.pageY<=s.y1+e.offset)&&(t.pageY>=s.y2-e.offset?(a=e.increment,this.scrolling.y=1):t.pageY<=s.y1+e.offset&&(a=-e.increment,this.scrolling.y=-1),h+=a,this.container.scrollTop=this.offset.scroll.y=h),(0<i||i<o-s.width)&&(t.pageX>=s.x2-e.offset||t.pageX<=s.x1+e.offset)&&(t.pageX>=s.x2-e.offset?(l=e.increment,this.scrolling.x=1):t.pageX<=s.x1+e.offset&&(l=-e.increment,this.scrolling.x=-1),r+=l,this.container.scrollLeft=this.offset.scroll.x=r),this.data.x=this.origin.scroll.x-this.offset.scroll.x,this.data.y=this.origin.scroll.y-this.offset.scroll.y,0<this.scrolling.x?this.data.right=this.data.x:this.scrolling.x<0&&(this.data.left=this.data.x),0<this.scrolling.y?this.data.down=this.data.y:this.scrolling.y<0&&(this.data.up=this.data.y)},highlight:function(t,e){var s=this.offset,i=this.config,n=i.classes,o=t.node,c=t.rect,l=this.data,a=!1;"touch"==i.tolerance?a=!(c.x1>s.x2+l.left||c.x2<s.x1+l.right||c.y1>s.y2+l.up||c.y2<s.y1+l.down):"fit"==i.tolerance&&(a=c.x1>s.x1+l.right&&c.x2<s.x2+l.left&&c.y1>s.y1+l.down&&c.y2<s.y2+l.up),a?(t.selected&&!i.toggle&&(f.remove(o,n.selected),t.selected=!1),t.unselecting&&(!i.toggle||i.toggle&&"drag"!==i.toggle)&&(f.remove(o,n.unselecting),t.unselecting=!1),t.selecting||(f.add(o,n.selecting),t.selecting=!0)):(t.selecting&&(e&&t.startselected?(f.remove(o,n.selecting),t.selecting=!1,f.add(o,n.selected),t.selected=!0):(f.remove(o,n.selecting),t.selecting=!1,t.startselected&&!i.toggle&&(f.add(o,n.unselecting),t.unselecting=!0))),o.selected&&(e||t.startselected||(f.remove(o,n.selected),t.selected=!1,f.add(o,n.unselecting),t.unselecting=!0)))},setContainer:function(t){var e,s=this.config;(this.container&&(e=this.container,this.unbind()),"string"==typeof(t=t||s.appendTo)?this.container=document.querySelector(t):t instanceof Element&&t.nodeName&&(this.container=t),f.add(this.container,this.config.classes.container),e&&f.remove(e,this.config.classes.container),c(s.filter)?this.nodes=[].slice.call(s.filter):"string"==typeof s.filter&&(this.nodes=[].slice.call(this.container.querySelectorAll(s.filter))),this.autoscroll)&&("static"===a(this.container).position&&a(this.container,{position:"relative"}));this.bind()},select:function(t,e){if(c(t))return d(t,function(t){this.select(t)},this),this.getSelectedItems();if(t=this.get(t)){if(this.config.toggle&&"drag"===this.config.toggle&&!e&&t.selected&&!this.cmdDown)return this.unselect(t);var s=t.node,i=this.config.classes;return f.remove(s,i.selecting),f.add(s,i.selected),t.selecting=!1,t.selected=!0,t.startselected=!0,this.emit("selectable.select",t),t}return!1},unselect:function(t){if(c(t))return d(t,function(t){this.unselect(t)},this),this.getSelectedItems();if(t=this.get(t)){var e=t.node,s=this.config.classes;return t.selecting=!1,t.selected=!1,t.unselecting=!1,t.startselected=!1,f.remove(e,s.unselecting),f.remove(e,s.selecting),f.remove(e,s.selected),this.emit("selectable.unselect",t),t}return!1},add:function(t){c(t)?d(t,function(t){this.nodes.indexOf(t)<0&&t instanceof Element&&this.nodes.push(t)},this):this.nodes.indexOf(t)<0&&t instanceof Element&&this.nodes.push(t),this.update()},remove:function(t,e){if(t=this.get(t)){if(c(t))for(var s=t.length-1;0<=s;s--)this.remove(t[s],0<s);else{var i=t.node,n=this.config.classes,o=f.remove;o(i,n.selectable),o(i,n.unselecting),o(i,n.selecting),o(i,n.selected),this.nodes.splice(this.nodes.indexOf(t.node),1)}return e||this.update(),!0}return!1},recalculate:function(){d(this.nodes,function(t,e){this.items[e].rect=r(t)},this),this.emit("selectable.recalculate")},selectAll:function(){d(this.items,function(t){this.select(t,!0)},this)},clear:function(){for(var t=this.items.length-1;0<=t;t--)this.unselect(this.items[t])},get:function(t){var e=!1;return c(t)?(e=[],d(t,function(t){(t=this.get(t))&&e.push(t)},this)):isNaN(t)?t instanceof Element?e=this.items[this.nodes.indexOf(t)]:o(t)&&0<=this.items.indexOf(t)&&(e=t):0<=this.items.indexOf(this.items[t])&&(e=this.items[t]),e},getItems:function(){return this.items},getNodes:function(){return this.nodes},getSelectedItems:function(){return this.getItems().filter(function(t){return t.selected})},getSelectedNodes:function(){return this.getSelectedItems().map(function(t){return t.node})},on:function(t,e){this.listeners=this.listeners||{},this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e)},off:function(t,e){this.listeners=this.listeners||{},t in this.listeners!=!1&&this.listeners[t].splice(this.listeners[t].indexOf(e),1)},emit:function(t){if(this.listeners=this.listeners||{},t in this.listeners!=!1)for(var e=0;e<this.listeners[t].length;e++)this.listeners[t][e].apply(this,Array.prototype.slice.call(arguments,1))},enable:function(){return this.enabled||(this.enabled=!0,this.bind(),f.add(this.container,this.config.classes.container),this.emit("selectable.enable")),this.enabled},disable:function(){return this.enabled&&(this.enabled=!1,this.unbind(),f.remove(this.container,this.config.classes.container),this.emit("selectable.disable")),this.enabled},destroy:function(){this.disable(),this.listeners=!1,this.remove(this.items)}},t});