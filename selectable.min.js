/*
 Selectable
 Copyright (c) 2017 Karl Saunders (http://mobius.ovh)
 Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.

 Version: 0.15.2

*/
(function(t,k){"object"===typeof exports?module.exports=k("Selectable"):"function"===typeof define&&define.amd?define([],k):t.Selectable=k("Selectable")})("undefined"!==typeof global?global:this.window||this.global,function(){var t,k,g,x,G,y,z,C,m,H,p,u,l,n,h,D,P,Q,I,J,K,L,M="classList"in document.documentElement,N=function(a,b){return a&&a!==document.documentElement&&(b(a)?a:N(a.parentNode,b))},A=function(a){return"[object Object]"===Object.prototype.toString.call(a)},r=function(a){return Array.isArray(a)||
    a instanceof HTMLCollection||a instanceof NodeList},O=function(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];d&&A(d)?(a[c]=a[c]||{},O(a[c],d)):a[c]=d}return a},E=function(a,b){var c=a.style;if(a){if(void 0===b)return window.getComputedStyle(a);if(A(b))for(var d in b)d in c||(d="-webkit-"+d),a.style[d]=b[d]+("string"===typeof b[d]?"":"opacity"===d?"":"px")}},F=function(a){var b=window;a=a.getBoundingClientRect();var c=document.documentElement||document.body.parentNode||document.body,d=void 0!==
    b.pageXOffset?b.pageXOffset:c.scrollLeft;b=void 0!==b.pageYOffset?b.pageYOffset:c.scrollTop;return{x1:a.left+d,x2:a.left+a.width+d,y1:a.top+b,y2:a.top+a.height+b,height:a.height,width:a.width}},T=function(a,b,c){var d;return function(){c=c||this;if(!d)return a.apply(c,arguments),d=!0,setTimeout(function(){d=!1},b)}},e={add:function(a,b){M?a.classList.add(b):e.contains(a,b)||(a.className=a.className.trim()+" "+b)},remove:function(a,b){M?a.classList.remove(b):e.contains(a,b)&&(a.className=a.className.replace(new RegExp("(^|\\s)"+
    b.split(" ").join("|")+"(\\s|$)","gi")," "))},contains:function(a,b){if(a)return M?a.classList.contains(b):!!a.className&&!!a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}},B=function(a){return!!a.ctrlKey||!!a.metaKey},v=["x","y"],f={x:"x1",y:"y1"},w={x:"x2",y:"y2"},R=function(a){this.version="0.15.2";this.v=this.version.split(".").map(function(a){return parseInt(a,10)});x="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch;this.init(a)};R.prototype={init:function(a){var b=
    this,c=this,d=this.config=O({filter:".ui-selectable",tolerance:"touch",appendTo:document.body,toggle:!1,autoRefresh:!0,throttle:50,autoScroll:{threshold:0,increment:10},saveState:!1,ignore:!1,lasso:{border:"1px dotted #000",backgroundColor:"rgba(52, 152, 219, 0.2)"},keys:["shiftKey","ctrlKey","metaKey",""],classes:{lasso:"ui-lasso",selected:"ui-selected",container:"ui-container",selecting:"ui-selecting",selectable:"ui-selectable",deselecting:"ui-deselecting"}},a);k=A(d.autoScroll);this.lasso=!1;d.lasso&&
    A(d.lasso)&&(this.lasso=document.createElement("div"),this.lasso.className=d.classes.lasso,E(this.lasso,O({position:"absolute",boxSizing:"border-box",opacity:0},d.lasso)));x&&(d.toggle=!1);this.events={};"_start _touchstart _drag _end _keyup _keydown _blur _focus".split(" ").forEach(function(a){b.events[a]=b[a].bind(b)});this.events._refresh=T(this.refresh,d.throttle,this);k&&(this.events._scroll=this._onScroll.bind(this));this.setContainer();r(d.filter)?this.nodes=[].slice.call(d.filter):"string"===
    typeof d.filter&&(this.nodes=[].slice.call(this.container.querySelectorAll(d.filter)));this.nodes.forEach(function(a){e.add(a,d.classes.selectable)});this.update();this.enable();setTimeout(function(){d.saveState&&c.state("save");c.emit(15>c.v[1]?"selectable.init":"init")},10)},update:function(){this._loadItems();this.refresh();this.emit(15>this.v[1]?"selectable.update":"update",this.items)},refresh:function(){var a=window.innerWidth,b=window.innerHeight,c=m?window.pageXOffset:this.container.scrollLeft,
    d=m?window.pageYOffset:this.container.scrollTop;Q=this.container.offsetWidth;P=this.container.offsetHeight;J=this.container.clientWidth;I=this.container.clientHeight;L=this.container.scrollWidth;K=this.container.scrollHeight;p=F(this.container);m&&(p.x2=a,p.y2=b);g={x:c,y:d,max:{x:L-(m?a:J),y:K-(m?b:I)},size:{x:J,y:I},scrollable:{x:L>Q,y:K>P}};for(a=0;a<this.nodes.length;a++)this.items[a].rect=F(this.nodes[a]);this.emit(15>this.v[1]?"selectable.refresh":"refresh")},bind:function(){var a=this.events;
    this.unbind();if(x){if(this.on(this.container,"touchstart",a._touchstart),this.on(document,"touchend",a._end),this.on(document,"touchcancel",a._end),!1!==this.lasso)this.on(document,"touchmove",a._drag)}else if(this.on(this.container,"mousedown",a._start),this.on(document,"mouseup",a._end),this.on(document,"keydown",a._keydown),this.on(document,"keyup",a._keyup),this.on(this.container,"mouseenter",a._focus),this.on(this.container,"mouseleave",a._blur),!1!==this.lasso)this.on(document,"mousemove",
    a._drag);if(k)this.on(m?window:this.container,"scroll",a._scroll);this.on(window,"resize",a._refresh);this.on(window,"scroll",a._refresh)},unbind:function(){var a=this.events;this.off(this.container,"mousedown",a._start);this.off(document,"mousemove",a._drag);this.off(document,"mouseup",a._end);this.off(document,"keydown",a._keydown);this.off(document,"keyup",a._keyup);this.off(this.container,"mouseenter",a._focus);this.off(this.container,"mouseleave",a._blur);k&&this.off(m?window:this.container,
    "scroll",a._scroll);this.off(this.container,"touchstart",a._start);this.off(document,"touchend",a._end);this.off(document,"touchcancel",a._end);this.off(document,"touchmove",a._drag);this.off(window,"resize",a._refresh);this.off(window,"scroll",a._refresh)},setContainer:function(a){var b=this.config;if(this.container){var c=this.container;this.unbind()}a=a||b.appendTo;"string"===typeof a?this.container=document.querySelector(a):a instanceof Element&&a.nodeName&&(this.container=a);e.add(this.container,
    b.classes.container);c&&e.remove(c,b.classes.container);m=this.container===document.body;this._loadItems();k&&"static"===E(this.container).position&&!m&&(this.container.style.position="relative");this.bind()},select:function(a,b){if(r(a)){for(var c=0;c<a.length;c++)this.select(a[c]);return this.getSelectedItems()}if(a=this.get(a)){if(this.config.toggle&&"drag"===this.config.toggle&&!b&&a.selected&&!C)return this.deselect(a);c=a.node;var d=this.config.classes;e.remove(c,d.selecting);e.add(c,d.selected);
    a.selecting=!1;a.selected=!0;a.startselected=!0;this.emit(15>this.v[1]?"selectable.select":"selecteditem",a);return a}return!1},deselect:function(a){if(r(a)){for(var b=0;b<a.length;b++)this.deselect(a[b]);return this.getSelectedItems()}if(a=this.get(a)){b=a.node;var c=this.config.classes;a.selecting=!1;a.selected=!1;a.deselecting=!1;a.startselected=!1;e.remove(b,c.deselecting);e.remove(b,c.selecting);e.remove(b,c.selected);this.emit(15>this.v[1]?"selectable.deselect":"deselecteditem",a);return a}return!1},
    toggle:function(a){if(a=this.get(a)){r(a)||(a=[a]);for(var b=0;b<a.length;b++)a[b].selected?this.deselect(a[b]):this.select(a[b])}},add:function(a){var b=[];r(a)||(a=[a]);for(var c=0;c<a.length;c++)0>this.nodes.indexOf(a[c])&&a[c]instanceof Element&&(b.push(a[c]),e.add(a[c],this.config.classes.selectable));this.nodes=this.nodes.concat(b);this.update();for(c=0;c<b.length;c++)this.emit("addeditem",this.get(b[c]))},remove:function(a,b){if(a=this.get(a)){if(r(a))for(var c=a.length-1;0<=c;c--)this.remove(a[c],
    0<c);else{c=a.node;var d=this.config.classes,g=e.remove;g(c,d.selectable);g(c,d.deselecting);g(c,d.selecting);g(c,d.selected);this.nodes.splice(this.nodes.indexOf(a.node),1);this.emit("removeditem",a)}b||this.update();return!0}return!1},selectAll:function(){for(var a=0;a<this.items.length;a++)this.select(this.items[a],!0)},invert:function(){this.getItems();for(var a=0;a<this.items.length;a++){var b=this.items[a];b.selected?this.deselect(b):this.select(b)}},clear:function(){for(var a=this.items.length-
    1;0<=a;a--)this.deselect(this.items[a])},get:function(a){var b=!1;if(r(a)){b=[];for(var c=0;c<a.length;c++){var d=this.get(a[c]);d&&b.push(d)}}else isNaN(a)?a instanceof Element?b=this.items[this.nodes.indexOf(a)]:A(a)&&0<=this.items.indexOf(a)&&(b=a):0<=this.items.indexOf(this.items[a])&&(b=this.items[a]);return b},getItems:function(){return this.items},getNodes:function(){return this.nodes},getSelectedItems:function(a){return this.getItems().filter(function(b){return a?!b.selected:b.selected})},
    getSelectedNodes:function(){return this.getSelectedItems().map(function(a){return a.node})},state:function(a){var b=!1,c=!1;switch(a){case "save":this.states=this.states||[];this.states.push(this.getSelectedNodes());c=this.config.saveState;c="isInteger"in Number?Number.isInteger(c):!isNaN(c);c&&this.states.length>this.config.saveState&&this.states.shift();this.currentState=this.states.length-1;c=!0;break;case "undo":0<this.currentState&&(this.currentState--,c=b=!0);break;case "redo":this.currentState<
    this.states.length-1&&(this.currentState++,c=b=!0);break;case "clear":this.states=[],this.currentState=!1}b&&(this.clear(),this.select(this.states[this.currentState]));c&&this.emit((15>this.v[1]?"selectable.state.":"state.")+a,this.states[this.currentState],this.states)},enable:function(){if(!this.enabled){var a=this.config.keys;this.enabled=!0;G=0<=a.indexOf("shiftKey");y=0<=a.indexOf("ctrlKey");z=0<=a.indexOf("metaKey");this.bind();e.add(this.container,this.config.classes.container);this.emit(15>
    this.v[1]?"selectable.enable":"enabled")}return this.enabled},disable:function(){this.enabled&&(this.enabled=!1,this.unbind(),e.remove(this.container,this.config.classes.container),this.emit(15>this.v[1]?"selectable.disable":"disabled"));return this.enabled},destroy:function(){this.disable();this.listeners=!1;this.clear();this.state("clear");this.remove(this.items)},on:function(a,b,c){"string"===typeof a?(this.listeners=this.listeners||{},this.listeners[a]=this.listeners[a]||[],this.listeners[a].push(b)):
    a.addEventListener(b,c,!1)},off:function(a,b,c){"string"===typeof a?(this.listeners=this.listeners||{},!1!==a in this.listeners&&this.listeners[a].splice(this.listeners[a].indexOf(b),1)):a.removeEventListener(b,c)},emit:function(a){this.listeners=this.listeners||{};if(!1!==a in this.listeners)for(var b=0;b<this.listeners[a].length;b++)this.listeners[a][b].apply(this,Array.prototype.slice.call(arguments,1))},_touchstart:function(a){this.off(this.container,"mousedown",this.events.start);this._start(a)},
    _start:function(a){var b=this,c=this._getEvent(a),d=this.config,h,n=B(a)&&(y||z),S=G&&!!a.shiftKey;if(!(!this.container.contains(a.target)||3===a.which||0<a.button||d.disabled)){if(g.scrollable.y&&c.pageX>p.x1+g.size.x||g.scrollable.x&&c.pageY>p.y1+g.size.y)return!1;if(this.config.ignore){var f=!1,q=this.config.ignore;Array.isArray(q)||(q=[q]);for(var k=0;k<q.length;k++)if(a.target.closest(q[k])){f=!0;break}if(f)return!1}f=N(a.target,function(a){return a===b.container||e.contains(a,d.classes.selectable)});
    if(!f)return!1;-1===["INPUT","SELECT","BUTTON","TEXTAREA","OPTION"].indexOf(a.target.tagName)&&a.preventDefault();D=!0;u={x:c.pageX+(m?0:g.x),y:c.pageY+(m?0:g.y),scroll:{x:g.x,y:g.y}};this.lasso&&this.container.appendChild(this.lasso);f!==this.container&&(c=this.get(f),c.selecting=!0,e.add(f,d.classes.selecting));d.autoRefresh&&this.refresh();if(S&&t){k=this.items;c=this.getNodes().indexOf(f);q=this.getNodes().indexOf(t);for(var l=c<q?1:-1;(c+=l)&&c!==q;)k[c].selecting=!0}for(k=0;k<this.items.length;k++)c=
    this.items[k],q=c.node,l=q===f,c.selected&&(c.startselected=!0,(x||d.toggle||n?!l:l||S)||(e.remove(q,d.classes.selected),c.selected=!1,e.add(q,d.classes.deselecting),c.deselecting=!0)),l&&(h=c);t=f;this.emit(15>this.v[1]?"selectable.start":"start",a,h)}},_drag:function(a){if(!(this.config.disabled||!D||a.shiftKey&&G)){var b=this._getEvent(a);B(a);l={x:b.pageX,y:b.pageY};h={x1:u.x,y1:u.y,x2:l.x+(m?0:g.x),y2:l.y+(m?0:g.y)};for(var c=0;c<v.length;c++){var d=v[c];h[f[d]]>h[w[d]]&&(b=h[w[d]],h[w[d]]=h[f[d]],
    h[f[d]]=b)}for(c=0;c<this.items.length;c++)this._highlight(this.items[c],B(a)&&(y||z));n={x1:h.x1,x2:h.x2-h.x1,y1:h.y1,y2:h.y2-h.y1};k&&(m||(n.x1-=p.x1,n.y1-=p.y1),this._autoScroll());this.lasso&&(m||!k||this.config.autoScroll.lassoOverflow||this._limitLasso(),E(this.lasso,{left:n.x1,top:n.y1,width:n.x2,height:n.y2,opacity:1}));this.emit(15>this.v[1]?"selectable.drag":"drag",a,n)}},_end:function(a){if(D){D=!1;var b=this.config,c=a.target,d=this._getEvent(a),g=[],h=[];this.lasso&&this.container.contains(this.lasso)&&
    this.container.removeChild(this.lasso);this.lasso&&(E(this.lasso,{opacity:0,left:0,width:0,top:0,height:0}),c=document.elementFromPoint(d.pageX,d.pageY),c||(c=this.container));c=N(c,function(a){return e.contains(a,b.classes.selectable)});for(d=0;d<this.items.length;d++){var f=this.items[d];b.toggle&&f.node===c&&f.node===t&&f.selecting&&f.startselected&&(f.deselecting=!0,f.selecting=!1);f.deselecting&&(h.push(f),this.deselect(f));f.selecting&&(g.push(f),this.select(f))}b.saveState&&this.state("save");
    this.emit(15>this.v[1]?"selectable.end":"end",a,g,h)}},_keydown:function(a){C=B(a)&&(y||z);var b=!1;void 0!==a.key?b=a.key:void 0!==a.keyCode&&(b=a.keyCode);if(b)if(C&&H)switch(b){case 65:case "a":case "A":this.selectAll();break;case 89:case "y":case "Y":this.state("redo");break;case 90:case "z":case "Z":this.state("undo")}else switch(b){case 32:case " ":this.toggle(document.activeElement)}},_keyup:function(a){C=B(a)&&(y||z)},_onScroll:function(a){g.x=m?window.pageXOffset:this.container.scrollLeft;
    g.y=m?window.pageYOffset:this.container.scrollTop;for(a=0;a<this.items.length;a++)this.items[a].rect=F(this.items[a].node)},_loadItems:function(){var a=this.config;this.nodes=[].slice.call(this.container.querySelectorAll("."+a.classes.selectable));this.items=[];if(this.nodes.length)for(var b=0;b<this.nodes.length;b++){var c=this.nodes[b];e.add(c,a.classes.selectable);this.items.push({node:c,rect:F(c),startselected:!1,selected:e.contains(c,a.classes.selected),selecting:e.contains(c,a.classes.selecting),
    deselecting:e.contains(c,a.classes.deselecting)})}},_getEvent:function(a){return x?"touchend"===a.type?a.changedTouches[0]:a.touches[0]:a},_autoScroll:function(){var a=this.config.autoScroll,b=a.increment;a=a.threshold;var c={x:0,y:0};m&&(l.x-=g.x,l.y-=g.y);for(var d=0;d<v.length;d++){var e=v[d];l[e]>=p[w[e]]-a&&g[e]<g.max[e]?c[e]=b:l[e]<=p[f[e]]+a&&0<g[e]&&(c[e]=-b)}m?window.scrollBy(c.x,c.y):(this.container.scrollTop+=c.y,this.container.scrollLeft+=c.x)},_limitLasso:function(){for(var a=0;a<v.length;a++){var b=
    v[a],c=p[f[b]]+g.size[b];if(l[b]>=c&&g[b]>=g.max[b]){var d=u[b]-p[f[b]]-g[b];n[f[b]]=u[b]-p[f[b]];n[w[b]]=c-d-p[f[b]]}l[b]<=p[f[b]]&&0>=g[b]&&(n[f[b]]=0,n[w[b]]=u[b]-p[f[b]])}},_highlight:function(a,b){var c=this.config,d=a.node,f=!1,k=m?0:g.x,l=m?0:g.y;"touch"===c.tolerance?f=!(a.rect.x1+k>h.x2||a.rect.x2+k<h.x1||a.rect.y1+l>h.y2||a.rect.y2+l<h.y1):"fit"===c.tolerance&&(f=a.rect.x1+k>h.x1&&a.rect.x2+k<h.x2&&a.rect.y1+l>h.y1&&a.rect.y2+l<h.y2);f?(a.selected&&!c.toggle&&(e.remove(d,c.classes.selected),
    a.selected=!1),a.deselecting&&(!c.toggle||c.toggle&&"drag"!==c.toggle)&&(e.remove(d,c.classes.deselecting),a.deselecting=!1),a.selecting||(e.add(d,c.classes.selecting),a.selecting=!0)):(a.selecting&&(e.remove(d,c.classes.selecting),a.selecting=!1,b&&a.startselected?(e.add(d,c.classes.selected),a.selected=!0):a.startselected&&!c.toggle&&(e.add(d,c.classes.deselecting),a.deselecting=!0)),!d.selected||b||a.startselected||(e.remove(d,c.classes.selected),a.selected=!1,e.add(d,c.classes.deselecting),a.deselecting=
    !0))},_focus:function(a){H=!0;e.add(this.container,"ui-focused")},_blur:function(a){H=!1;e.remove(this.container,"ui-focused")}};return R});