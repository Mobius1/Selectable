/*!
 *
 * Selectable
 * Copyright (c) 2017 Karl Saunders (http://mobius.ovh)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 0.12.2
 *
 */
(function(a,f){var g="Selectable";"object"==typeof exports?module.exports=f(g):"function"==typeof define&&define.amd?define([],f):a[g]=f(g)})("undefined"==typeof global?this.window||this.global:global,function(){"use strict";function a(E){var F={toggle:!1,autoRefresh:!0,throttle:50,appendTo:document.body,filter:".ui-selectable",tolerance:"touch",autoScroll:{offset:40,increment:20},ignore:!1,lasso:{border:"1px dotted #000",backgroundColor:"rgba(52, 152, 219, 0.2)"},classes:{lasso:"ui-lasso",selected:"ui-selected",container:"ui-container",selecting:"ui-selecting",selectable:"ui-selectable",unselecting:"ui-unselecting"}};this.version="0.12.2",this.config=s(F,E),this.init()}var g="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,j="classList"in document.documentElement,k=function(E,F,G){E.addEventListener(F,G,!1)},l=function(E,F,G){E.removeEventListener(F,G)},m=function(E,F){return E&&E!==document.documentElement&&(F(E)?E:m(E.parentNode,F))},p=function(E){return"[object Object]"===Object.prototype.toString.call(E)},q=function(E){return Array.isArray(E)||E instanceof HTMLCollection||E instanceof NodeList},s=function(E,F){for(var G in F)if(F.hasOwnProperty(G)){var H=F[G];H&&p(H)?(E[G]=E[G]||{},s(E[G],H)):E[G]=H}return E},t=function(E,F,G){if(p(E))for(var H in E)Object.prototype.hasOwnProperty.call(E,H)&&F.call(G,E[H],H);else for(H=0;H<E.length;H++)F.call(G,E[H],H)},u=function(E,F){var G=E.style;if(E){if(void 0===F)return window.getComputedStyle(E);p(F)&&t(F,function(H,I){I in G||(I="-webkit-"+I),E.style[I]=H+("string"==typeof H?"":"opacity"===I?"":"px")})}},v=function(E){var F=window,G=E.getBoundingClientRect(),H=document.documentElement||document.body.parentNode||document.body,I=void 0===F.pageXOffset?H.scrollLeft:F.pageXOffset,J=void 0===F.pageYOffset?H.scrollTop:F.pageYOffset;return{x1:G.left+I,x2:G.left+G.width+I,y1:G.top+J,y2:G.top+G.height+J,height:G.height,width:G.width}},z=function(E,F,G){var H;return function(){if(G=G||this,!H)return E.apply(G,arguments),H=!0,setTimeout(function(){H=!1},F)}},A={add:function(E,F){j?E.classList.add(F):!A.contains(E,F)&&(E.className=E.className.trim()+" "+F)},remove:function(E,F){j?E.classList.remove(F):A.contains(E,F)&&(E.className=E.className.replace(new RegExp("(^|\\s)"+F.split(" ").join("|")+"(\\s|$)","gi")," "))},contains:function(E,F){if(E)return j?E.classList.contains(F):!!E.className&&!!E.className.match(new RegExp("(\\s|^)"+F+"(\\s|$)"))}},B=function(E,F){Array.isArray(F)||(F=[F]);for(var G=-1<F.indexOf(E.nodeName.toLowerCase()),H=!1,I=0;I<F.length;I++)if("."==F[I].charAt(0)&&A.contains(E,F[I].substring(1))){H=!0;break}return G||H},C=function(E){return!!E.ctrlKey||!!E.metaKey},D=function(E){return!!E.shiftKey};return a.prototype={init:function(){var E=this,F=this.config;this.autoscroll=p(F.autoScroll),this.lasso=!1,F.lasso&&p(F.lasso)&&(this.lasso=document.createElement("div"),this.lasso.className=F.classes.lasso,u(this.lasso,s({position:"absolute",opacity:0},F.lasso))),g&&(F.toggle=!1),this.events={start:this.start.bind(this),touchstart:this.touchstart.bind(this),drag:this.drag.bind(this),end:this.end.bind(this),keyup:this.keyup.bind(this),keydown:this.keydown.bind(this),recalculate:z(this.recalculate,F.throttle,this)},this.autoscroll&&(this.events.scroll=this.onScroll.bind(this)),this.setContainer(),this.update(),this.enable(),setTimeout(function(){E.emit("selectable.init")},10)},update:function(){var E=this.config.classes,F=A.contains,G=this.container.scrollLeft,H=this.container.scrollTop,I=this.container.scrollWidth,J=this.container.scrollHeight;this.rect=v(this.container),this.scroll={x:G,y:H,max:{x:I-this.container.clientWidth,y:J-this.container.clientHeight}},this.items=[],t(this.nodes,function(K,L){A.add(K,E.selectable),this.items[L]={node:K,rect:v(K),startselected:!1,selected:F(K,E.selected),selecting:F(K,E.selecting),unselecting:F(K,E.unselecting)}},this),this.emit("selectable.update",this.items)},bind:function(){var E=this.events;g?(k(this.container,"touchstart",E.touchstart),k(document,"touchend",E.end),k(document,"touchcancel",E.end),!1!==this.lasso&&k(document,"touchmove",E.drag)):(k(this.container,"mousedown",E.start),k(document,"mouseup",E.end),k(document,"keydown",E.keydown),k(document,"keyup",E.keyup),!1!==this.lasso&&k(document,"mousemove",E.drag)),this.autoscroll&&k(this.container,"scroll",E.scroll),k(window,"resize",E.recalculate),k(window,"scroll",E.recalculate)},unbind:function(){var E=this.events;l(this.container,"mousedown",E.start),l(document,"mousemove",E.drag),l(document,"mouseup",E.end),l(document,"keydown",E.keydown),l(document,"keyup",E.keyup),this.autoscroll&&l(this.container,"scroll",E.scroll),l(this.container,"touchstart",E.start),l(document,"touchend",E.end),l(document,"touchcancel",E.end),l(document,"touchmove",E.drag),l(window,"resize",E.recalculate),l(window,"scroll",E.recalculate)},touchstart:function(E){l(this.container,"mousedown",this.events.start),this.start(E)},start:function(E){var F=E.target;if(this.container.contains(E.target)&&3!==E.which&&!(0<E.button)){if(this.config.ignore&&B(F,this.config.ignore))return!1;var I,G=this,H=this.config,J=m(E.target,function(Q){return Q===G.container||A.contains(Q,H.classes.selectable)});if(!J||H.disabled)return!1;-1===["INPUT","SELECT","BUTTON","TEXTAREA","OPTION"].indexOf(E.target.tagName)&&E.preventDefault();var K="touchstart"===E.type,L=window;if(this.dragging=!0,this.origin={x:(K?E.touches[0].pageX:E.pageX)+this.scroll.x,y:(K?E.touches[0].pageY:E.pageY)+this.scroll.y,scroll:{x:this.scroll.x,y:this.scroll.y}},this.lasso&&this.container.appendChild(this.lasso),J!==this.container&&A.add(J,H.classes.selecting),H.autoRefresh&&this.update(),D(E)&&this.startEl)for(var M=this.items,N=this.getNodes().indexOf(J),O=this.getNodes().indexOf(this.startEl),P=N<O?1:-1;(N+=P)&&N!==O;)M[N].selecting=!0;t(this.items,function(Q){var R=Q.node,S=R===J;if(Q.selected){Q.startselected=!0;var T=!1;T=K||H.toggle||C(E)?S:!S&&!D(E),T&&(A.remove(R,H.classes.selected),Q.selected=!1,A.add(R,H.classes.unselecting),Q.unselecting=!0)}S&&(I=Q)}),this.startEl=J,this.emit("selectable.start",E,I)}},drag:function(E){var F=this.config;if(!(F.disabled||!this.dragging||D(E))){var I,G=this,J=window,K="touchmove"===E.type?E.touches[0]:E;if(this.current={x1:this.origin.x,y1:this.origin.y,x2:K.pageX+this.scroll.x,y2:K.pageY+this.scroll.y},this.current.x1>this.current.x2&&(I=this.current.x2,this.current.x2=this.current.x1,this.current.x1=I),this.current.y1>this.current.y2&&(I=this.current.y2,this.current.y2=this.current.y1,this.current.y1=I),t(this.items,function(L){G.highlight(L,C(E))}),this.coords={x1:this.current.x1,x2:this.current.x2-this.current.x1,y1:this.current.y1,y2:this.current.y2-this.current.y1},this.autoscroll){const L=this.config.autoScroll;let M=0,N=0;K.pageY>=this.rect.y2-L.offset&&this.scroll.y<this.scroll.max.y?N=L.increment:K.pageY<=this.rect.y1+L.offset&&0<this.scroll.y&&(N=-L.increment),K.pageX>=this.rect.x2-L.offset&&this.scroll.x<this.scroll.max.x?M=L.increment:K.pageX<=this.rect.x1+L.offset&&0<this.scroll.x&&(M=-L.increment),0<N&&(this.container.scrollTop+=N),0<M&&(this.container.scrollLeft+=M)}this.lasso&&u(this.lasso,{left:this.coords.x1-this.rect.x1,top:this.coords.y1-this.rect.y1,width:this.coords.x2,height:this.coords.y2,opacity:1}),this.emit("selectable.drag",E)}},end:function(E){if(this.dragging){this.dragging=!1,this.stopY=!1;var I,F=this,G=F.config,H=E.target,J=[],K=[],L="touchend"===E.type?E.touches[0]||E.changedTouches[0]:E;this.lasso&&this.container.contains(this.lasso)&&this.container.removeChild(this.lasso),this.lasso&&(u(this.lasso,{opacity:0,left:0,width:0,top:0,height:0}),H=document.elementFromPoint(L.pageX,L.pageY)),I=m(H,function(M){return A.contains(M,G.classes.selectable)}),t(this.items,function(M){G.toggle&&M.node===I&&M.node===F.startEl&&M.selecting&&M.startselected&&(M.unselecting=!0,M.selecting=!1),M.unselecting&&(K.push(M),this.unselect(M)),M.selecting&&(J.push(M),this.select(M))},this),this.emit("selectable.end",E,J,K)}},keydown:function(E){if(this.cmdDown=C(E),this.shiftDown=D(E),this.cmdDown){var F=E.code||E.keyCode;(65==F||97==F)&&(E.preventDefault(),this.selectAll())}},keyup:function(E){this.cmdDown=C(E),this.shiftDown=D(E)},onScroll:function(){this.scroll.x=this.container.scrollLeft,this.scroll.y=this.container.scrollTop,t(this.items,function(F){F.rect=v(F.node)})},highlight:function(E,F){var G=this.offset,H=this.config,I=H.classes,J=E.node,K=E.rect,L=!1;"touch"===H.tolerance?L=!(K.x1+this.scroll.x>this.current.x2||K.x2+this.scroll.x<this.current.x1||K.y1+this.scroll.y>this.current.y2||K.y2+this.scroll.y<this.current.y1):"fit"===H.tolerance&&(L=K.x1+this.scroll.x>this.current.x1&&K.x2+this.scroll.x<this.current.x2&&K.y1+this.scroll.y>this.current.y1&&K.y2+this.scroll.y<this.current.y2),L?(E.selected&&!H.toggle&&(A.remove(J,I.selected),E.selected=!1),E.unselecting&&(!H.toggle||H.toggle&&"drag"!==H.toggle)&&(A.remove(J,I.unselecting),E.unselecting=!1),!E.selecting&&(A.add(J,I.selecting),E.selecting=!0)):(E.selecting&&(F&&E.startselected?(A.remove(J,I.selecting),E.selecting=!1,A.add(J,I.selected),E.selected=!0):(A.remove(J,I.selecting),E.selecting=!1,E.startselected&&!H.toggle&&(A.add(J,I.unselecting),E.unselecting=!0))),J.selected&&!F&&!E.startselected&&(A.remove(J,I.selected),E.selected=!1,A.add(J,I.unselecting),E.unselecting=!0))},setContainer:function(E){var G,F=this.config;if(this.container&&(G=this.container,this.unbind()),E=E||F.appendTo,"string"==typeof E?this.container=document.querySelector(E):E instanceof Element&&E.nodeName&&(this.container=E),A.add(this.container,this.config.classes.container),G&&A.remove(G,this.config.classes.container),q(F.filter)?this.nodes=[].slice.call(F.filter):"string"==typeof F.filter&&(this.nodes=[].slice.call(this.container.querySelectorAll(F.filter))),this.autoscroll){var H=u(this.container);("static"===H.position||this.container!==document.body)&&u(this.container,{position:"relative"})}this.bind()},select:function(E,F){if(q(E))return t(E,function(I){this.select(I)},this),this.getSelectedItems();if(E=this.get(E),E){if(this.config.toggle&&"drag"===this.config.toggle&&!F&&E.selected&&!this.cmdDown)return this.unselect(E);var G=E.node,H=this.config.classes;return A.remove(G,H.selecting),A.add(G,H.selected),E.selecting=!1,E.selected=!0,E.startselected=!0,this.emit("selectable.select",E),E}return!1},unselect:function(E){if(q(E))return t(E,function(H){this.unselect(H)},this),this.getSelectedItems();if(E=this.get(E),E){var F=E.node,G=this.config.classes;return E.selecting=!1,E.selected=!1,E.unselecting=!1,E.startselected=!1,A.remove(F,G.unselecting),A.remove(F,G.selecting),A.remove(F,G.selected),this.emit("selectable.unselect",E),E}return!1},add:function(E){q(E)?t(E,function(F){0>this.nodes.indexOf(F)&&F instanceof Element&&this.nodes.push(F)},this):0>this.nodes.indexOf(E)&&E instanceof Element&&this.nodes.push(E),this.update()},remove:function(E,F){if(E=this.get(E),E){if(q(E))for(var G=E.length-1;0<=G;G--)this.remove(E[G],0<G);else{var H=E.node,I=this.config.classes,J=A.remove;J(H,I.selectable),J(H,I.unselecting),J(H,I.selecting),J(H,I.selected),this.nodes.splice(this.nodes.indexOf(E.node),1)}return F||this.update(),!0}return!1},recalculate:function(){t(this.nodes,function(E,F){this.items[F].rect=v(E)},this),this.emit("selectable.recalculate")},selectAll:function(){t(this.items,function(E){this.select(E,!0)},this)},clear:function(){for(var E=this.items.length-1;0<=E;E--)this.unselect(this.items[E])},get:function(E){var F=!1;return q(E)?(F=[],t(E,function(G){G=this.get(G),G&&F.push(G)},this)):isNaN(E)?E instanceof Element?F=this.items[this.nodes.indexOf(E)]:p(E)&&0<=this.items.indexOf(E)&&(F=E):0<=this.items.indexOf(this.items[E])&&(F=this.items[E]),F},getItems:function(){return this.items},getNodes:function(){return this.nodes},getSelectedItems:function(){return this.getItems().filter(function(E){return E.selected})},getSelectedNodes:function(){return this.getSelectedItems().map(function(E){return E.node})},on:function(E,F){this.listeners=this.listeners||{},this.listeners[E]=this.listeners[E]||[],this.listeners[E].push(F)},off:function(E,F){this.listeners=this.listeners||{},!1==E in this.listeners||this.listeners[E].splice(this.listeners[E].indexOf(F),1)},emit:function(E){if(this.listeners=this.listeners||{},!1!=E in this.listeners)for(var F=0;F<this.listeners[E].length;F++)this.listeners[E][F].apply(this,Array.prototype.slice.call(arguments,1))},enable:function(){return this.enabled||(this.enabled=!0,this.bind(),A.add(this.container,this.config.classes.container),this.emit("selectable.enable")),this.enabled},disable:function(){return this.enabled&&(this.enabled=!1,this.unbind(),A.remove(this.container,this.config.classes.container),this.emit("selectable.disable")),this.enabled},destroy:function(){this.disable(),this.listeners=!1,this.remove(this.items)}},a});