/*!
 *
 * Selectable
 * Copyright (c) 2017 Karl Saunders (http://mobius.ovh)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 0.12.1
 *
 */
(function(a,f){var g="Selectable";"object"==typeof exports?module.exports=f(g):"function"==typeof define&&define.amd?define([],f):a[g]=f(g)})("undefined"==typeof global?this.window||this.global:global,function(){"use strict";function a(F){var G={toggle:!1,autoRefresh:!0,throttle:50,appendTo:document.body,filter:".ui-selectable",tolerance:"touch",autoScroll:{offset:40,increment:20},ignore:!1,lasso:{border:"1px dotted #000",backgroundColor:"rgba(52, 152, 219, 0.2)"},classes:{lasso:"ui-lasso",selected:"ui-selected",container:"ui-container",selecting:"ui-selecting",selectable:"ui-selectable",unselecting:"ui-unselecting"}};this.version="0.12.1",this.config=s(G,F),this.init()}var g="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,j="classList"in document.documentElement,k=function(F,G,H){F.addEventListener(G,H,!1)},l=function(F,G,H){F.removeEventListener(G,H)},m=function(F,G){return F&&F!==document.documentElement&&(G(F)?F:m(F.parentNode,G))},p=function(F){return"[object Object]"===Object.prototype.toString.call(F)},q=function(F){return Array.isArray(F)||F instanceof HTMLCollection||F instanceof NodeList},s=function(F,G){for(var H in G)if(G.hasOwnProperty(H)){var I=G[H];I&&p(I)?(F[H]=F[H]||{},s(F[H],I)):F[H]=I}return F},u=function(F,G,H){if(p(F))for(var I in F)Object.prototype.hasOwnProperty.call(F,I)&&G.call(H,F[I],I);else for(I=0;I<F.length;I++)G.call(H,F[I],I)},v=function(F,G){var H=F.style;if(F){if(void 0===G)return window.getComputedStyle(F);p(G)&&u(G,function(I,J){J in H||(J="-webkit-"+J),F.style[J]=I+("string"==typeof I?"":"opacity"===J?"":"px")})}},z=function(F){var G=window,H=F.getBoundingClientRect(),I=document.documentElement||document.body.parentNode||document.body,J=void 0===G.pageXOffset?I.scrollLeft:G.pageXOffset,K=void 0===G.pageYOffset?I.scrollTop:G.pageYOffset;return{x1:H.left+J,x2:H.left+H.width+J,y1:H.top+K,y2:H.top+H.height+K,height:H.height,width:H.width}},A=function(F,G,H){var I;return function(){if(H=H||this,!I)return F.apply(H,arguments),I=!0,setTimeout(function(){I=!1},G)}},B={add:function(F,G){j?F.classList.add(G):!B.contains(F,G)&&(F.className=F.className.trim()+" "+G)},remove:function(F,G){j?F.classList.remove(G):B.contains(F,G)&&(F.className=F.className.replace(new RegExp("(^|\\s)"+G.split(" ").join("|")+"(\\s|$)","gi")," "))},contains:function(F,G){if(F)return j?F.classList.contains(G):!!F.className&&!!F.className.match(new RegExp("(\\s|^)"+G+"(\\s|$)"))}},C=function(F,G){Array.isArray(G)||(G=[G]);for(var H=-1<G.indexOf(F.nodeName.toLowerCase()),I=!1,J=0;J<G.length;J++)if("."==G[J].charAt(0)&&B.contains(F,G[J].substring(1))){I=!0;break}return H||I},D=function(F){return!!F.ctrlKey||!!F.metaKey},E=function(F){return!!F.shiftKey};return a.prototype={init:function(){var F=this,G=this.config;this.autoscroll=p(G.autoScroll),this.lasso=!1,G.lasso&&p(G.lasso)&&(this.lasso=document.createElement("div"),this.lasso.className=G.classes.lasso,v(this.lasso,s({position:"absolute",opacity:0},G.lasso))),g&&(G.toggle=!1),this.events={start:this.start.bind(this),touchstart:this.touchstart.bind(this),drag:this.drag.bind(this),end:this.end.bind(this),keyup:this.keyup.bind(this),keydown:this.keydown.bind(this),recalculate:A(this.recalculate,G.throttle,this)},this.autoscroll&&(this.events.scroll=this.onScroll.bind(this)),this.setContainer(),this.update(),this.enable(),setTimeout(function(){F.emit("selectable.init")},10)},update:function(){var F=this.config.classes,G=B.contains,H=this.container.scrollLeft,I=this.container.scrollTop,J=this.container.scrollWidth,K=this.container.scrollHeight;this.rect=z(this.container),this.scroll={x:H,y:I,max:{x:J-this.container.clientWidth,y:K-this.container.clientHeight}},this.items=[],u(this.nodes,function(L,M){B.add(L,F.selectable),this.items[M]={node:L,rect:z(L),startselected:!1,selected:G(L,F.selected),selecting:G(L,F.selecting),unselecting:G(L,F.unselecting)}},this),this.emit("selectable.update",this.items)},bind:function(){var F=this.events;g?(k(this.container,"touchstart",F.touchstart),k(document,"touchend",F.end),k(document,"touchcancel",F.end),!1!==this.lasso&&k(document,"touchmove",F.drag)):(k(this.container,"mousedown",F.start),k(document,"mouseup",F.end),k(document,"keydown",F.keydown),k(document,"keyup",F.keyup),!1!==this.lasso&&k(document,"mousemove",F.drag)),this.autoscroll&&k(this.container,"scroll",F.scroll),k(window,"resize",F.recalculate),k(window,"scroll",F.recalculate)},unbind:function(){var F=this.events;l(this.container,"mousedown",F.start),l(document,"mousemove",F.drag),l(document,"mouseup",F.end),l(document,"keydown",F.keydown),l(document,"keyup",F.keyup),this.autoscroll&&l(this.container,"scroll",F.scroll),l(this.container,"touchstart",F.start),l(document,"touchend",F.end),l(document,"touchcancel",F.end),l(document,"touchmove",F.drag),l(window,"resize",F.recalculate),l(window,"scroll",F.recalculate)},touchstart:function(F){l(this.container,"mousedown",this.events.start),this.start(F)},start:function(F){var G=F.target;if(this.container.contains(F.target)&&3!==F.which&&!(0<F.button)){if(this.config.ignore&&C(G,this.config.ignore))return!1;var J,H=this,I=this.config,K=m(F.target,function(R){return R===H.container||B.contains(R,I.classes.selectable)});if(!K||I.disabled)return!1;-1===["INPUT","SELECT","BUTTON","TEXTAREA","OPTION"].indexOf(F.target.tagName)&&F.preventDefault();var L="touchstart"===F.type,M=window;if(this.dragging=!0,this.origin={x:(L?F.touches[0].clientX:F.clientX)+this.scroll.x+M.pageXOffset,y:(L?F.touches[0].clientY:F.clientY)+this.scroll.y+M.pageYOffset,scroll:{x:this.scroll.x,y:this.scroll.y}},this.lasso&&this.container.appendChild(this.lasso),K!==this.container&&B.add(K,I.classes.selecting),I.autoRefresh&&this.update(),E(F)&&this.startEl)for(var N=this.items,O=this.getNodes().indexOf(K),P=this.getNodes().indexOf(this.startEl),Q=O<P?1:-1;(O+=Q)&&O!==P;)N[O].selecting=!0;u(this.items,function(R){var S=R.node,T=S===K;if(R.selected){R.startselected=!0;var U=!1;U=L||I.toggle||D(F)?T:!T&&!E(F),U&&(B.remove(S,I.classes.selected),R.selected=!1,B.add(S,I.classes.unselecting),R.unselecting=!0)}T&&(J=R)}),this.startEl=K,this.emit("selectable.start",F,J)}},drag:function(F){var G=this.config;if(!(G.disabled||!this.dragging||E(F))){var J,H=this,K=window,L="touchmove"===F.type;this.current={x1:this.origin.x,y1:this.origin.y,x2:F.clientX+this.scroll.x+K.pageXOffset,y2:F.clientY+this.scroll.y+K.pageYOffset},this.current.x1>this.current.x2&&(J=this.current.x2,this.current.x2=this.current.x1,this.current.x1=J),this.current.y1>this.current.y2&&(J=this.current.y2,this.current.y2=this.current.y1,this.current.y1=J),u(this.items,function(M){H.highlight(M,D(F))}),this.coords={x1:this.current.x1,x2:this.current.x2-this.current.x1,y1:this.current.y1,y2:this.current.y2-this.current.y1},this.autoscroll&&this.autoScroll(F),this.lasso&&v(this.lasso,{left:this.coords.x1-this.rect.x1,top:this.coords.y1-this.rect.y1,width:this.coords.x2,height:this.coords.y2,opacity:1}),this.emit("selectable.drag",F)}},end:function(F){if(this.dragging){this.dragging=!1,this.stopY=!1;var J,G=this,H=G.config,I=F.target,K=[],L=[],M="touchend"===F.type?F.touches[0]||F.changedTouches[0]:F;this.lasso&&this.container.contains(this.lasso)&&this.container.removeChild(this.lasso),this.lasso&&(v(this.lasso,{opacity:0,left:0,width:0,top:0,height:0}),I=document.elementFromPoint(M.pageX,M.pageY)),J=m(I,function(N){return B.contains(N,H.classes.selectable)}),u(this.items,function(N){H.toggle&&N.node===J&&N.node===G.startEl&&N.selecting&&N.startselected&&(N.unselecting=!0,N.selecting=!1),N.unselecting&&(L.push(N),this.unselect(N)),N.selecting&&(K.push(N),this.select(N))},this),this.emit("selectable.end",F,K,L)}},keydown:function(F){if(this.cmdDown=D(F),this.shiftDown=E(F),this.cmdDown){var G=F.code||F.keyCode;(65==G||97==G)&&(F.preventDefault(),this.selectAll())}},keyup:function(F){this.cmdDown=D(F),this.shiftDown=E(F)},onScroll:function(){this.scroll.x=this.container.scrollLeft,this.scroll.y=this.container.scrollTop,u(this.items,function(G){G.rect=z(G.node)})},autoScroll:function(F){const G=this.config.autoScroll;let H=0,I=0;F.clientY>=this.rect.y2-G.offset&&this.scroll.y<this.scroll.max.y?I=G.increment:F.clientY<=this.rect.y1+G.offset&&0<this.scroll.y&&(I=-G.increment),F.clientX>=this.rect.x2-G.offset&&this.scroll.x<this.scroll.max.x?H=G.increment:F.clientX<=this.rect.x1+G.offset&&0<this.scroll.x&&(H=-G.increment),this.container.scrollTop+=I,this.container.scrollLeft+=H},highlight:function(F,G){var H=this.offset,I=this.config,J=I.classes,K=F.node,L=F.rect,M=!1;"touch"===I.tolerance?M=!(L.x1+this.scroll.x>this.current.x2||L.x2+this.scroll.x<this.current.x1||L.y1+this.scroll.y>this.current.y2||L.y2+this.scroll.y<this.current.y1):"fit"===I.tolerance&&(M=L.x1+this.scroll.x>this.current.x1&&L.x2+this.scroll.x<this.current.x2&&L.y1+this.scroll.y>this.current.y1&&L.y2+this.scroll.y<this.current.y2),M?(F.selected&&!I.toggle&&(B.remove(K,J.selected),F.selected=!1),F.unselecting&&(!I.toggle||I.toggle&&"drag"!==I.toggle)&&(B.remove(K,J.unselecting),F.unselecting=!1),!F.selecting&&(B.add(K,J.selecting),F.selecting=!0)):(F.selecting&&(G&&F.startselected?(B.remove(K,J.selecting),F.selecting=!1,B.add(K,J.selected),F.selected=!0):(B.remove(K,J.selecting),F.selecting=!1,F.startselected&&!I.toggle&&(B.add(K,J.unselecting),F.unselecting=!0))),K.selected&&!G&&!F.startselected&&(B.remove(K,J.selected),F.selected=!1,B.add(K,J.unselecting),F.unselecting=!0))},setContainer:function(F){var H,G=this.config;if(this.container&&(H=this.container,this.unbind()),F=F||G.appendTo,"string"==typeof F?this.container=document.querySelector(F):F instanceof Element&&F.nodeName&&(this.container=F),B.add(this.container,this.config.classes.container),H&&B.remove(H,this.config.classes.container),q(G.filter)?this.nodes=[].slice.call(G.filter):"string"==typeof G.filter&&(this.nodes=[].slice.call(this.container.querySelectorAll(G.filter))),this.autoscroll){var I=v(this.container);("static"===I.position||this.container!==document.body)&&v(this.container,{position:"relative"})}this.bind()},select:function(F,G){if(q(F))return u(F,function(J){this.select(J)},this),this.getSelectedItems();if(F=this.get(F),F){if(this.config.toggle&&"drag"===this.config.toggle&&!G&&F.selected&&!this.cmdDown)return this.unselect(F);var H=F.node,I=this.config.classes;return B.remove(H,I.selecting),B.add(H,I.selected),F.selecting=!1,F.selected=!0,F.startselected=!0,this.emit("selectable.select",F),F}return!1},unselect:function(F){if(q(F))return u(F,function(I){this.unselect(I)},this),this.getSelectedItems();if(F=this.get(F),F){var G=F.node,H=this.config.classes;return F.selecting=!1,F.selected=!1,F.unselecting=!1,F.startselected=!1,B.remove(G,H.unselecting),B.remove(G,H.selecting),B.remove(G,H.selected),this.emit("selectable.unselect",F),F}return!1},add:function(F){q(F)?u(F,function(G){0>this.nodes.indexOf(G)&&G instanceof Element&&this.nodes.push(G)},this):0>this.nodes.indexOf(F)&&F instanceof Element&&this.nodes.push(F),this.update()},remove:function(F,G){if(F=this.get(F),F){if(q(F))for(var H=F.length-1;0<=H;H--)this.remove(F[H],0<H);else{var I=F.node,J=this.config.classes,K=B.remove;K(I,J.selectable),K(I,J.unselecting),K(I,J.selecting),K(I,J.selected),this.nodes.splice(this.nodes.indexOf(F.node),1)}return G||this.update(),!0}return!1},recalculate:function(){u(this.nodes,function(F,G){this.items[G].rect=z(F)},this),this.emit("selectable.recalculate")},selectAll:function(){u(this.items,function(F){this.select(F,!0)},this)},clear:function(){for(var F=this.items.length-1;0<=F;F--)this.unselect(this.items[F])},get:function(F){var G=!1;return q(F)?(G=[],u(F,function(H){H=this.get(H),H&&G.push(H)},this)):isNaN(F)?F instanceof Element?G=this.items[this.nodes.indexOf(F)]:p(F)&&0<=this.items.indexOf(F)&&(G=F):0<=this.items.indexOf(this.items[F])&&(G=this.items[F]),G},getItems:function(){return this.items},getNodes:function(){return this.nodes},getSelectedItems:function(){return this.getItems().filter(function(F){return F.selected})},getSelectedNodes:function(){return this.getSelectedItems().map(function(F){return F.node})},on:function(F,G){this.listeners=this.listeners||{},this.listeners[F]=this.listeners[F]||[],this.listeners[F].push(G)},off:function(F,G){this.listeners=this.listeners||{},!1==F in this.listeners||this.listeners[F].splice(this.listeners[F].indexOf(G),1)},emit:function(F){if(this.listeners=this.listeners||{},!1!=F in this.listeners)for(var G=0;G<this.listeners[F].length;G++)this.listeners[F][G].apply(this,Array.prototype.slice.call(arguments,1))},enable:function(){return this.enabled||(this.enabled=!0,this.bind(),B.add(this.container,this.config.classes.container),this.emit("selectable.enable")),this.enabled},disable:function(){return this.enabled&&(this.enabled=!1,this.unbind(),B.remove(this.container,this.config.classes.container),this.emit("selectable.disable")),this.enabled},destroy:function(){this.disable(),this.listeners=!1,this.remove(this.items)}},a});