/*
 Selectable
 Copyright (c) 2017 Karl Saunders (http://mobius.ovh)
 Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.

 Version: 0.13.4

*/
(function(q,p){"object"===typeof exports?module.exports=p("Selectable"):"function"===typeof define&&define.amd?define([],p):q.Selectable=p("Selectable")})("undefined"!==typeof global?global:this.window||this.global,function(){var q="classList"in document.documentElement,p=function(a,b){return a&&a!==document.documentElement&&(b(a)?a:p(a.parentNode,b))},r=function(a){return"[object Object]"===Object.prototype.toString.call(a)},k=function(a){return Array.isArray(a)||a instanceof HTMLCollection||a instanceof
    NodeList},v=function(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];d&&r(d)?(a[c]=a[c]||{},v(a[c],d)):a[c]=d}return a},t=function(a,b){var c=a.style;if(a){if(void 0===b)return window.getComputedStyle(a);if(r(b))for(var d in b)d in c||(d="-webkit-"+d),a.style[d]=b[d]+("string"===typeof b[d]?"":"opacity"===d?"":"px")}},u=function(a){var b=window;a=a.getBoundingClientRect();var c=document.documentElement||document.body.parentNode||document.body,d=void 0!==b.pageXOffset?b.pageXOffset:c.scrollLeft;
    b=void 0!==b.pageYOffset?b.pageYOffset:c.scrollTop;return{x1:a.left+d,x2:a.left+a.width+d,y1:a.top+b,y2:a.top+a.height+b,height:a.height,width:a.width}},x=function(a,b,c){var d;return function(){c=c||this;if(!d)return a.apply(c,arguments),d=!0,setTimeout(function(){d=!1},b)}},f={add:function(a,b){q?a.classList.add(b):f.contains(a,b)||(a.className=a.className.trim()+" "+b)},remove:function(a,b){q?a.classList.remove(b):f.contains(a,b)&&(a.className=a.className.replace(new RegExp("(^|\\s)"+b.split(" ").join("|")+
    "(\\s|$)","gi")," "))},contains:function(a,b){if(a)return q?a.classList.contains(b):!!a.className&&!!a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}},w=function(a){this.axes=["x","y"];this.axes1={x:"x1",y:"y1"};this.axes2={x:"x2",y:"y2"};this.version="0.13.4";this.touch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch;this.init(a)};w.prototype={init:function(a){var b=this,c=this;a=this.config=v({filter:".ui-selectable",tolerance:"touch",appendTo:document.body,
    toggle:!1,autoRefresh:!0,throttle:50,autoScroll:{threshold:0,increment:20},ignore:!1,lasso:{border:"1px dotted #000",backgroundColor:"rgba(52, 152, 219, 0.2)"},keys:["shiftKey","ctrlKey","metaKey"],classes:{lasso:"ui-lasso",selected:"ui-selected",container:"ui-container",selecting:"ui-selecting",selectable:"ui-selectable",unselecting:"ui-unselecting"}},a);this.autoscroll=r(a.autoScroll);this.lasso=!1;a.lasso&&r(a.lasso)&&(this.lasso=document.createElement("div"),this.lasso.className=a.classes.lasso,
    t(this.lasso,v({position:"absolute",boxSizing:"border-box",opacity:0},a.lasso)));this.touch&&(a.toggle=!1);this.events={};"start touchstart drag end keyup keydown".split(" ").forEach(function(a){b.events[a]=b[a].bind(b)});this.events.refresh=x(this.refresh,a.throttle,this);this.autoscroll&&(this.events.scroll=this.onScroll.bind(this));this.setContainer();this.update();this.enable();setTimeout(function(){c.emit("selectable.init")},10)},update:function(){for(var a=this.config.classes,b=this.bodyContainer?
    window.pageXOffset:this.container.scrollLeft,c=this.bodyContainer?window.pageYOffset:this.container.scrollTop,d=["scroll","offset","client"],e=0;e<d.length;e++){var h=d[e];this[h+"Width"]=this.container[h+"Width"];this[h+"Height"]=this.container[h+"Height"]}this.rect=u(this.container);this.scroll={x:b,y:c,max:{x:this.scrollWidth-this.clientWidth,y:this.scrollHeight-this.clientHeight},size:{x:this.clientWidth,y:this.clientHeight},scrollable:{x:this.scrollWidth>this.offsetWidth,y:this.scrollHeight>
    this.offsetHeight}};this.items=[];for(b=0;b<this.nodes.length;b++)c=this.nodes[b],f.add(c,a.selectable),this.items.push({node:c,rect:u(c),startselected:!1,selected:f.contains(c,a.selected),selecting:f.contains(c,a.selecting),unselecting:f.contains(c,a.unselecting)});this.emit("selectable.update",this.items)},refresh:function(){for(var a=0;a<this.nodes.length;a++)this.items[a].rect=u(this.nodes[a]);this.emit("selectable.refresh")},on:function(a,b,c){"string"===typeof a?(this.listeners=this.listeners||
    {},this.listeners[a]=this.listeners[a]||[],this.listeners[a].push(b)):a.addEventListener(b,c,!1)},off:function(a,b,c){"string"===typeof a?(this.listeners=this.listeners||{},!1!==a in this.listeners&&this.listeners[a].splice(this.listeners[a].indexOf(b),1)):a.removeEventListener(b,c)},emit:function(a){this.listeners=this.listeners||{};if(!1!==a in this.listeners)for(var b=0;b<this.listeners[a].length;b++)this.listeners[a][b].apply(this,Array.prototype.slice.call(arguments,1))},bind:function(){var a=
    this.events;this.unbind();if(this.touch){if(this.on(this.container,"touchstart",a.touchstart),this.on(document,"touchend",a.end),this.on(document,"touchcancel",a.end),!1!==this.lasso)this.on(document,"touchmove",a.drag)}else if(this.on(this.container,"mousedown",a.start),this.on(document,"mouseup",a.end),this.on(document,"keydown",a.keydown),this.on(document,"keyup",a.keyup),!1!==this.lasso)this.on(document,"mousemove",a.drag);if(this.autoscroll)this.on(this.bodyContainer?window:this.container,"scroll",
    a.scroll);this.on(window,"resize",a.refresh);this.on(window,"scroll",a.refresh)},unbind:function(){var a=this.events;this.off(this.container,"mousedown",a.start);this.off(document,"mousemove",a.drag);this.off(document,"mouseup",a.end);this.off(document,"keydown",a.keydown);this.off(document,"keyup",a.keyup);this.autoscroll&&this.off(this.bodyContainer?window:this.container,"scroll",a.scroll);this.off(this.container,"touchstart",a.start);this.off(document,"touchend",a.end);this.off(document,"touchcancel",
    a.end);this.off(document,"touchmove",a.drag);this.off(window,"resize",a.refresh);this.off(window,"scroll",a.refresh)},touchstart:function(a){this.off(this.container,"mousedown",this.events.start);this.start(a)},start:function(a){var b=this,c=this._getEvent(a),d=this.config,e,h=(!!a.ctrlKey||!!a.metaKey)&&(this.canCtrl||this.canMeta),g=this.canShift&&!!a.shiftKey;if(!(!this.container.contains(a.target)||3===a.which||0<a.button||d.disabled)){if(this.scroll.scrollable.y&&c.pageX>this.rect.x1+this.scroll.size.x||
    this.scroll.scrollable.x&&c.pageY>this.rect.y1+this.scroll.size.y)return!1;if(this.config.ignore){var m=!1,l=this.config.ignore;Array.isArray(l)||(l=[l]);for(var n=0;n<l.length;n++)if(a.target.closest(l[n])){m=!0;break}if(m)return!1}m=p(a.target,function(a){return a===b.container||f.contains(a,d.classes.selectable)});if(!m)return!1;-1===["INPUT","SELECT","BUTTON","TEXTAREA","OPTION"].indexOf(a.target.tagName)&&a.preventDefault();this.dragging=!0;this.origin={x:c.pageX+(this.bodyContainer?0:this.scroll.x),
    y:c.pageY+(this.bodyContainer?0:this.scroll.y),scroll:{x:this.scroll.x,y:this.scroll.y}};this.lasso&&this.container.appendChild(this.lasso);m!==this.container&&f.add(m,d.classes.selecting);d.autoRefresh&&this.update();if(g&&this.startEl){n=this.items;c=this.getNodes().indexOf(m);l=this.getNodes().indexOf(this.startEl);for(var k=c<l?1:-1;(c+=k)&&c!==l;)n[c].selecting=!0}for(n=0;n<this.items.length;n++)c=this.items[n],l=c.node,k=l===m,c.selected&&(c.startselected=!0,(this.touch||d.toggle||h?!k:k||g)||
    (f.remove(l,d.classes.selected),c.selected=!1,f.add(l,d.classes.unselecting),c.unselecting=!0)),k&&(e=c);this.startEl=m;this.emit("selectable.start",a,e)}},drag:function(a){var b=this._getEvent(a);b={x:b.pageX,y:b.pageY};if(!(this.config.disabled||!this.dragging||a.shiftKey&&this.canShift)){var c=window;this.current={x1:this.origin.x,y1:this.origin.y,x2:b.x+(this.bodyContainer?0:this.scroll.x),y2:b.y+(this.bodyContainer?0:this.scroll.y)};for(var d=0;d<this.axes.length;d++){var e=this.axes[d];if(this.current[this.axes1[e]]>
    this.current[this.axes2[e]]){var f=this.current[this.axes2[e]];this.current[this.axes2[e]]=this.current[this.axes1[e]];this.current[this.axes1[e]]=f}}for(d=0;d<this.items.length;d++)this.highlight(this.items[d],(!!a.ctrlKey||!!a.metaKey)&&(this.canCtrl||this.canMeta));this.coords={x1:this.current.x1,x2:this.current.x2-this.current.x1,y1:this.current.y1,y2:this.current.y2-this.current.y1};this.bodyContainer||(this.coords.x1-=this.rect.x1,this.coords.y1-=this.rect.y1);if(this.autoscroll){f=this.config.autoScroll.threshold;
    var g={x:0,y:0};this.bodyContainer&&(b.x-=this.scroll.x,b.y-=this.scroll.y);for(d=0;d<this.axes.length;d++)e=this.axes[d],b[e]>=this.rect[this.axes2[e]]-f&&this.scroll[e]<this.scroll.max[e]?g[e]=d:b[e]<=this.rect[this.axes1[e]]+f&&0<this.scroll[e]&&(g[e]=-d);this.bodyContainer?c.scrollBy(g.x,g.y):(this.container.scrollTop+=g.y,this.container.scrollLeft+=g.x)}if(this.lasso){if(!this.bodyContainer&&!this.config.autoScroll.lassoOverflow)for(d=0;d<this.axes.length;d++)e=this.axes[d],c=this.rect[this.axes1[e]]+
    this.scroll.size[e],b[e]>=c&&this.scroll[e]>=this.scroll.max[e]&&(f=this.origin[e]-this.rect[this.axes1[e]]-this.scroll[e],this.coords[this.axes1[e]]=this.origin[e]-this.rect[this.axes1[e]],this.coords[this.axes2[e]]=c-f-this.rect[this.axes1[e]]),b[e]<=this.rect[this.axes1[e]]&&0>=this.scroll[e]&&(this.coords[this.axes1[e]]=0,this.coords[this.axes2[e]]=this.origin[e]-this.rect[this.axes1[e]]);t(this.lasso,{left:this.coords.x1,top:this.coords.y1,width:this.coords.x2,height:this.coords.y2,opacity:1})}this.emit("selectable.drag",
    a,this.coords)}},end:function(a){if(this.dragging){this.stopY=this.dragging=!1;var b=this.config,c=a.target,d=this._getEvent(a),e=[],h=[];this.lasso&&this.container.contains(this.lasso)&&this.container.removeChild(this.lasso);this.lasso&&(t(this.lasso,{opacity:0,left:0,width:0,top:0,height:0}),c=document.elementFromPoint(d.pageX,d.pageY));c=p(c,function(a){return f.contains(a,b.classes.selectable)});for(d=0;d<this.items.length;d++){var g=this.items[d];b.toggle&&g.node===c&&g.node===this.startEl&&
    g.selecting&&g.startselected&&(g.unselecting=!0,g.selecting=!1);g.unselecting&&(h.push(g),this.unselect(g));g.selecting&&(e.push(g),this.select(g))}this.emit("selectable.end",a,e,h)}},keydown:function(a){if(this.cmdDown=(!!a.ctrlKey||!!a.metaKey)&&(this.canCtrl||this.canMeta)){var b=a.code||a.keyCode;if(65==b||97==b)a.preventDefault(),this.selectAll()}},keyup:function(a){this.cmdDown=(!!a.ctrlKey||!!a.metaKey)&&(this.canCtrl||this.canMeta)},onScroll:function(a){this.scroll.x=this.bodyContainer?window.pageXOffset:
    this.container.scrollLeft;this.scroll.y=this.bodyContainer?window.pageYOffset:this.container.scrollTop;for(a=0;a<this.items.length;a++)this.items[a].rect=u(this.items[a].node)},highlight:function(a,b){var c=this.config,d=a.node,e=!1,h=this.bodyContainer?0:this.scroll.x,g=this.bodyContainer?0:this.scroll.y;"touch"===c.tolerance?e=!(a.rect.x1+h>this.current.x2||a.rect.x2+h<this.current.x1||a.rect.y1+g>this.current.y2||a.rect.y2+g<this.current.y1):"fit"===c.tolerance&&(e=a.rect.x1+h>this.current.x1&&
    a.rect.x2+h<this.current.x2&&a.rect.y1+g>this.current.y1&&a.rect.y2+g<this.current.y2);e?(a.selected&&!c.toggle&&(f.remove(d,c.classes.selected),a.selected=!1),a.unselecting&&(!c.toggle||c.toggle&&"drag"!==c.toggle)&&(f.remove(d,c.classes.unselecting),a.unselecting=!1),a.selecting||(f.add(d,c.classes.selecting),a.selecting=!0)):(a.selecting&&(f.remove(d,c.classes.selecting),a.selecting=!1,b&&a.startselected?(f.add(d,c.classes.selected),a.selected=!0):a.startselected&&!c.toggle&&(f.add(d,c.classes.unselecting),
    a.unselecting=!0)),!d.selected||b||a.startselected||(f.remove(d,c.classes.selected),a.selected=!1,f.add(d,c.classes.unselecting),a.unselecting=!0))},setContainer:function(a){var b=this.config;if(this.container){var c=this.container;this.unbind()}a=a||b.appendTo;"string"===typeof a?this.container=document.querySelector(a):a instanceof Element&&a.nodeName&&(this.container=a);f.add(this.container,b.classes.container);c&&f.remove(c,b.classes.container);this.bodyContainer=this.container===document.body;
    k(b.filter)?this.nodes=[].slice.call(b.filter):"string"===typeof b.filter&&(this.nodes=[].slice.call(this.container.querySelectorAll(b.filter)));this.autoscroll&&"static"===t(this.container).position&&!this.bodyContainer&&(this.container.style.position="relative");this.bind()},select:function(a,b){if(k(a)){for(var c=0;c<a.length;c++)this.select(a[c]);return this.getSelectedItems()}if(a=this.get(a)){if(this.config.toggle&&"drag"===this.config.toggle&&!b&&a.selected&&!this.cmdDown)return this.unselect(a);
    c=a.node;var d=this.config.classes;f.remove(c,d.selecting);f.add(c,d.selected);a.selecting=!1;a.selected=!0;a.startselected=!0;this.emit("selectable.select",a);return a}return!1},unselect:function(a){if(k(a)){for(var b=0;b<a.length;b++)this.unselect(a[b]);return this.getSelectedItems()}if(a=this.get(a)){b=a.node;var c=this.config.classes;a.selecting=!1;a.selected=!1;a.unselecting=!1;a.startselected=!1;f.remove(b,c.unselecting);f.remove(b,c.selecting);f.remove(b,c.selected);this.emit("selectable.unselect",
    a);return a}return!1},add:function(a){var b=this.nodes;if(k(a))for(var c=0;c<a.length;c++)0>b.indexOf(a[c])&&a[c]instanceof Element&&b.push(a[c]);else 0>b.indexOf(a)&&a instanceof Element&&b.push(a);this.update()},remove:function(a,b){if(a=this.get(a)){if(k(a))for(var c=a.length-1;0<=c;c--)this.remove(a[c],0<c);else{c=a.node;var d=this.config.classes,e=f.remove;e(c,d.selectable);e(c,d.unselecting);e(c,d.selecting);e(c,d.selected);this.nodes.splice(this.nodes.indexOf(a.node),1)}b||this.update();return!0}return!1},
    selectAll:function(){for(var a=0;a<this.items.length;a++)this.select(this.items[a],!0)},invert:function(){this.getItems();for(var a=0;a<this.items.length;a++){var b=this.items[a];b.selected?this.unselect(b):this.select(b)}},clear:function(){for(var a=this.items.length-1;0<=a;a--)this.unselect(this.items[a])},get:function(a){var b=!1;if(k(a)){b=[];for(var c=0;c<a.length;c++){var d=this.get(a[c]);d&&b.push(d)}}else isNaN(a)?a instanceof Element?b=this.items[this.nodes.indexOf(a)]:r(a)&&0<=this.items.indexOf(a)&&
    (b=a):0<=this.items.indexOf(this.items[a])&&(b=this.items[a]);return b},getItems:function(){return this.items},getNodes:function(){return this.nodes},getSelectedItems:function(a){return this.getItems().filter(function(b){return a?!b.selected:b.selected})},getSelectedNodes:function(){return this.getSelectedItems().map(function(a){return a.node})},enable:function(){if(!this.enabled){var a=this.config.keys;this.enabled=!0;this.canShift=0<=a.indexOf("shiftKey");this.canCtrl=0<=a.indexOf("ctrlKey");this.canMeta=
    0<=a.indexOf("metaKey");this.bind();f.add(this.container,this.config.classes.container);this.emit("selectable.enable")}return this.enabled},disable:function(){this.enabled&&(this.enabled=!1,this.unbind(),f.remove(this.container,this.config.classes.container),this.emit("selectable.disable"));return this.enabled},destroy:function(){this.disable();this.listeners=!1;this.remove(this.items)},_getEvent:function(a){return this.touch?"touchend"===a.type?a.changedTouches[0]:a.touches[0]:a}};return w});