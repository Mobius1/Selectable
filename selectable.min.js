/*!
 *
 * Selectable
 * Copyright (c) 2017 Karl Saunders (http://mobius.ovh)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 0.13.1
 *
 */
(function(a,f){var g="Selectable";"object"==typeof exports?module.exports=f(g):"function"==typeof define&&define.amd?define([],f):a[g]=f(g)})("undefined"==typeof global?this.window||this.global:global,function(){"use strict";var f="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,g="classList"in document.documentElement,j=function(E,F,G){E.addEventListener(F,G,!1)},k=function(E,F,G){E.removeEventListener(F,G)},l=function(E,F){return E&&E!==document.documentElement&&(F(E)?E:l(E.parentNode,F))},m=function(E){return"[object Object]"===Object.prototype.toString.call(E)},p=function(E){return Array.isArray(E)||E instanceof HTMLCollection||E instanceof NodeList},q=function(E,F){for(var G in F)if(F.hasOwnProperty(G)){var H=F[G];H&&m(H)?(E[G]=E[G]||{},q(E[G],H)):E[G]=H}return E},t=function(E,F){var G=E.style;if(E){if(void 0===F)return window.getComputedStyle(E);if(m(F))for(var H in F)H in G||(H="-webkit-"+H),E.style[H]=F[H]+("string"==typeof F[H]?"":"opacity"==H?"":"px")}},u=function(E){var F=window,G=E.getBoundingClientRect(),H=document.documentElement||document.body.parentNode||document.body,I=void 0===F.pageXOffset?H.scrollLeft:F.pageXOffset,J=void 0===F.pageYOffset?H.scrollTop:F.pageYOffset;return{x1:G.left+I,x2:G.left+G.width+I,y1:G.top+J,y2:G.top+G.height+J,height:G.height,width:G.width}},v=function(E,F,G){var H;return function(){if(G=G||this,!H)return E.apply(G,arguments),H=!0,setTimeout(function(){H=!1},F)}},z={add:function(E,F){g?E.classList.add(F):!z.contains(E,F)&&(E.className=E.className.trim()+" "+F)},remove:function(E,F){g?E.classList.remove(F):z.contains(E,F)&&(E.className=E.className.replace(new RegExp("(^|\\s)"+F.split(" ").join("|")+"(\\s|$)","gi")," "))},contains:function(E,F){if(E)return g?E.classList.contains(F):!!E.className&&!!E.className.match(new RegExp("(\\s|^)"+F+"(\\s|$)"))}},A=function(E,F){Array.isArray(F)||(F=[F]);for(var G=-1<F.indexOf(E.nodeName.toLowerCase()),H=!1,I=0;I<F.length;I++)if("."==F[I].charAt(0)&&z.contains(E,F[I].substring(1))){H=!0;break}return G||H},B=function(E){return!!E.ctrlKey||!!E.metaKey},C=function(E){return!!E.shiftKey},D=function(E){var F={toggle:!1,autoRefresh:!0,throttle:50,appendTo:document.body,filter:".ui-selectable",tolerance:"touch",autoScroll:{threshold:40,increment:20},ignore:!1,lasso:{border:"1px dotted #000",backgroundColor:"rgba(52, 152, 219, 0.2)"},classes:{lasso:"ui-lasso",selected:"ui-selected",container:"ui-container",selecting:"ui-selecting",selectable:"ui-selectable",unselecting:"ui-unselecting"}};this.version="0.13.1",this.config=q(F,E),this.init()};return D.prototype={init:function(){var E=this,F=this.config;this.autoscroll=m(F.autoScroll),this.lasso=!1,F.lasso&&m(F.lasso)&&(this.lasso=document.createElement("div"),this.lasso.className=F.classes.lasso,t(this.lasso,q({position:"absolute",opacity:0},F.lasso))),f&&(F.toggle=!1),this.events={start:this.start.bind(this),touchstart:this.touchstart.bind(this),drag:this.drag.bind(this),end:this.end.bind(this),keyup:this.keyup.bind(this),keydown:this.keydown.bind(this),recalculate:v(this.recalculate,F.throttle,this)},this.autoscroll&&(this.events.scroll=this.onScroll.bind(this)),this.setContainer(),this.update(),this.enable(),setTimeout(function(){E.emit("selectable.init")},10)},update:function(){var E=this.config.classes,F=z.contains,G=this.bodyContainer?window.pageXOffset:this.container.scrollLeft,H=this.bodyContainer?window.pageYOffset:this.container.scrollTop,I=this.container.scrollWidth,J=this.container.scrollHeight;this.rect=u(this.container),this.scroll={x:G,y:H,max:{x:I-this.container.clientWidth,y:J-this.container.clientHeight}},this.items=[];for(var L,K=0;K<this.nodes.length;K++)L=this.nodes[K],z.add(L,E.selectable),this.items[K]={node:L,rect:u(L),startselected:!1,selected:F(L,E.selected),selecting:F(L,E.selecting),unselecting:F(L,E.unselecting)};this.emit("selectable.update",this.items)},bind:function(){var E=this.events;f?(j(this.container,"touchstart",E.touchstart),j(document,"touchend",E.end),j(document,"touchcancel",E.end),!1!==this.lasso&&j(document,"touchmove",E.drag)):(j(this.container,"mousedown",E.start),j(document,"mouseup",E.end),j(document,"keydown",E.keydown),j(document,"keyup",E.keyup),!1!==this.lasso&&j(document,"mousemove",E.drag)),this.autoscroll&&j(this.bodyContainer?window:this.container,"scroll",E.scroll),j(window,"resize",E.recalculate),j(window,"scroll",E.recalculate)},unbind:function(){var E=this.events;k(this.container,"mousedown",E.start),k(document,"mousemove",E.drag),k(document,"mouseup",E.end),k(document,"keydown",E.keydown),k(document,"keyup",E.keyup),this.autoscroll&&k(this.bodyContainer?window:this.container,"scroll",E.scroll),k(this.container,"touchstart",E.start),k(document,"touchend",E.end),k(document,"touchcancel",E.end),k(document,"touchmove",E.drag),k(window,"resize",E.recalculate),k(window,"scroll",E.recalculate)},touchstart:function(E){k(this.container,"mousedown",this.events.start),this.start(E)},start:function(E){var K,F=this,G=this.config,H=E.target,I="touchstart"===E.type,J=window;if(this.container.contains(H)&&3!==E.which&&!(0<E.button)){if(this.config.ignore&&A(H,this.config.ignore))return!1;var L=l(H,function(V){return V===F.container||z.contains(V,G.classes.selectable)});if(!L||G.disabled)return!1;if(-1===["INPUT","SELECT","BUTTON","TEXTAREA","OPTION"].indexOf(H.tagName)&&E.preventDefault(),this.dragging=!0,this.origin={x:(I?E.touches[0].pageX:E.pageX)+(this.bodyContainer?0:this.scroll.x),y:(I?E.touches[0].pageY:E.pageY)+(this.bodyContainer?0:this.scroll.y),scroll:{x:this.scroll.x,y:this.scroll.y}},this.lasso&&this.container.appendChild(this.lasso),L!==this.container&&z.add(L,G.classes.selecting),G.autoRefresh&&this.update(),C(E)&&this.startEl)for(var M=this.items,N=this.getNodes().indexOf(L),O=this.getNodes().indexOf(this.startEl),P=N<O?1:-1;(N+=P)&&N!==O;)M[N].selecting=!0;for(var Q=0;Q<this.items.length;Q++){var R=this.items[Q],S=R.node,T=S===L;if(R.selected){R.startselected=!0;var U=!1;U=I||G.toggle||B(E)?T:!T&&!C(E),U&&(z.remove(S,G.classes.selected),R.selected=!1,z.add(S,G.classes.unselecting),R.unselecting=!0)}T&&(K=R)}this.startEl=L,this.emit("selectable.start",E,K)}},drag:function(E){var F=this.config;if(!(F.disabled||!this.dragging||C(E))){var G,H=window,I="touchmove"===E.type?E.touches[0]:E;this.current={x1:this.origin.x,y1:this.origin.y,x2:I.pageX+(this.bodyContainer?0:this.scroll.x),y2:I.pageY+(this.bodyContainer?0:this.scroll.y)},this.current.x1>this.current.x2&&(G=this.current.x2,this.current.x2=this.current.x1,this.current.x1=G),this.current.y1>this.current.y2&&(G=this.current.y2,this.current.y2=this.current.y1,this.current.y1=G);for(var J=0;J<this.items.length;J++)this.highlight(this.items[J],B(E));if(this.coords={x1:this.current.x1,x2:this.current.x2-this.current.x1,y1:this.current.y1,y2:this.current.y2-this.current.y1},this.container!==document.body&&(this.coords.x1-=this.rect.x1,this.coords.y1-=this.rect.y1),this.autoscroll){var F=this.config.autoScroll,K=0,L=0,M=I.pageX,N=I.pageY;this.bodyContainer&&(M-=this.scroll.x,N-=this.scroll.y),N>=this.rect.y2-F.threshold&&this.scroll.y<this.scroll.max.y?L=F.increment:N<=this.rect.y1+F.threshold&&0<this.scroll.y&&(L=-F.increment),M>=this.rect.x2-F.threshold&&this.scroll.x<this.scroll.max.x?K=F.increment:M<=this.rect.x1+F.threshold&&0<this.scroll.x&&(K=-F.increment),this.bodyContainer?window.scrollBy(K,L):(this.container.scrollTop+=L,this.container.scrollLeft+=K)}if(this.lasso){if(!this.bodyContainer){if(E.pageY>=this.rect.y2&&this.scroll.y>=this.scroll.max.y){const O=this.origin.y-this.rect.y1-this.scroll.y;this.coords.y1=this.origin.y-this.rect.y1,this.coords.y2=this.rect.y2-O-this.rect.y1-2}E.pageY<=this.rect.y1&&0>=this.scroll.y&&(this.coords.y1=0,this.coords.y2=this.origin.y-this.rect.y1)}t(this.lasso,{left:this.coords.x1,top:this.coords.y1,width:this.coords.x2,height:this.coords.y2,opacity:1})}this.emit("selectable.drag",E,this.coords)}},end:function(E){if(this.dragging){this.dragging=!1,this.stopY=!1;var I,F=this,G=F.config,H=E.target,J=[],K=[],L="touchend"===E.type?E.touches[0]||E.changedTouches[0]:E;this.lasso&&this.container.contains(this.lasso)&&this.container.removeChild(this.lasso),this.lasso&&(t(this.lasso,{opacity:0,left:0,width:0,top:0,height:0}),H=document.elementFromPoint(L.pageX,L.pageY)),I=l(H,function(O){return z.contains(O,G.classes.selectable)});for(var N,M=0;M<this.items.length;M++)N=this.items[M],G.toggle&&N.node===I&&N.node===F.startEl&&N.selecting&&N.startselected&&(N.unselecting=!0,N.selecting=!1),N.unselecting&&(K.push(N),this.unselect(N)),N.selecting&&(J.push(N),this.select(N));this.emit("selectable.end",E,J,K)}},keydown:function(E){if(this.cmdDown=B(E),this.shiftDown=C(E),this.cmdDown){var F=E.code||E.keyCode;(65==F||97==F)&&(E.preventDefault(),this.selectAll())}},keyup:function(E){this.cmdDown=B(E),this.shiftDown=C(E)},onScroll:function(){this.scroll.x=this.bodyContainer?window.pageXOffset:this.container.scrollLeft,this.scroll.y=this.bodyContainer?window.pageYOffset:this.container.scrollTop;for(var F=0;F<this.items.length;F++)this.items[F].rect=u(this.items[F].node)},highlight:function(E,F){var G=this.config,H=G.classes,I=E.node,J=E.rect,K=this.current,L=this.scroll,M=z,N=!1,O=L.x,P=L.y;this.bodyContainer&&(O=0,P=0),"touch"===G.tolerance?N=!(J.x1+O>K.x2||J.x2+O<K.x1||J.y1+P>K.y2||J.y2+P<K.y1):"fit"===G.tolerance&&(N=J.x1+O>K.x1&&J.x2+O<K.x2&&J.y1+P>K.y1&&J.y2+P<K.y2),N?(E.selected&&!G.toggle&&(M.remove(I,H.selected),E.selected=!1),E.unselecting&&(!G.toggle||G.toggle&&"drag"!==G.toggle)&&(M.remove(I,H.unselecting),E.unselecting=!1),!E.selecting&&(M.add(I,H.selecting),E.selecting=!0)):(E.selecting&&(F&&E.startselected?(M.remove(I,H.selecting),E.selecting=!1,M.add(I,H.selected),E.selected=!0):(M.remove(I,H.selecting),E.selecting=!1,E.startselected&&!G.toggle&&(M.add(I,H.unselecting),E.unselecting=!0))),I.selected&&!F&&!E.startselected&&(M.remove(I,H.selected),E.selected=!1,M.add(I,H.unselecting),E.unselecting=!0))},setContainer:function(E){var G,F=this.config;if(this.container&&(G=this.container,this.unbind()),E=E||F.appendTo,"string"==typeof E?this.container=document.querySelector(E):E instanceof Element&&E.nodeName&&(this.container=E),z.add(this.container,this.config.classes.container),G&&z.remove(G,this.config.classes.container),p(F.filter)?this.nodes=[].slice.call(F.filter):"string"==typeof F.filter&&(this.nodes=[].slice.call(this.container.querySelectorAll(F.filter))),this.autoscroll){var H=t(this.container);"static"===H.position&&this.container!==document.body&&t(this.container,{position:"relative"})}this.bodyContainer=this.container===document.body,this.bind()},select:function(E,F){if(p(E)){for(var G=0;G<E.length;G++)this.select(E[G]);return this.getSelectedItems()}if(E=this.get(E),E){if(this.config.toggle&&"drag"===this.config.toggle&&!F&&E.selected&&!this.cmdDown)return this.unselect(E);var H=E.node,I=this.config.classes;return z.remove(H,I.selecting),z.add(H,I.selected),E.selecting=!1,E.selected=!0,E.startselected=!0,this.emit("selectable.select",E),E}return!1},unselect:function(E){if(p(E)){for(var F=0;F<E.length;F++)this.unselect(E[F]);return this.getSelectedItems()}if(E=this.get(E),E){var G=E.node,H=this.config.classes;return E.selecting=!1,E.selected=!1,E.unselecting=!1,E.startselected=!1,z.remove(G,H.unselecting),z.remove(G,H.selecting),z.remove(G,H.selected),this.emit("selectable.unselect",E),E}return!1},add:function(E){if(p(E))for(var F=0;F<E.length;F++)0>this.nodes.indexOf(E[F])&&E[F]instanceof Element&&this.nodes.push(E[F]);else 0>this.nodes.indexOf(E)&&E instanceof Element&&this.nodes.push(E);this.update()},remove:function(E,F){if(E=this.get(E),E){if(p(E))for(var G=E.length-1;0<=G;G--)this.remove(E[G],0<G);else{var H=E.node,I=this.config.classes,J=z.remove;J(H,I.selectable),J(H,I.unselecting),J(H,I.selecting),J(H,I.selected),this.nodes.splice(this.nodes.indexOf(E.node),1)}return F||this.update(),!0}return!1},recalculate:function(){for(var E=0;E<this.nodes.length;E++)this.items[E].rect=u(this.nodes[E]);this.emit("selectable.recalculate")},selectAll:function(){for(var E=0;E<this.items.length;E++)this.select(this.items[E],!0)},invert:function(){this.getItems();for(var G,F=0;F<this.items.length;F++)G=this.items[F],G.selected?this.unselect(G):this.select(G)},clear:function(){for(var E=this.items.length-1;0<=E;E--)this.unselect(this.items[E])},get:function(E){var F=!1;if(p(E)){F=[];for(var G=0;G<E.length;G++)G=this.get(G),G&&F.push(G)}else isNaN(E)?E instanceof Element?F=this.items[this.nodes.indexOf(E)]:m(E)&&0<=this.items.indexOf(E)&&(F=E):0<=this.items.indexOf(this.items[E])&&(F=this.items[E]);return F},getItems:function(){return this.items},getNodes:function(){return this.nodes},getSelectedItems:function(E){return this.getItems().filter(function(F){return E?!F.selected:F.selected})},getSelectedNodes:function(){return this.getSelectedItems().map(function(E){return E.node})},on:function(E,F){this.listeners=this.listeners||{},this.listeners[E]=this.listeners[E]||[],this.listeners[E].push(F)},off:function(E,F){this.listeners=this.listeners||{},!1==E in this.listeners||this.listeners[E].splice(this.listeners[E].indexOf(F),1)},emit:function(E){if(this.listeners=this.listeners||{},!1!=E in this.listeners)for(var F=0;F<this.listeners[E].length;F++)this.listeners[E][F].apply(this,Array.prototype.slice.call(arguments,1))},enable:function(){return this.enabled||(this.enabled=!0,this.bind(),z.add(this.container,this.config.classes.container),this.emit("selectable.enable")),this.enabled},disable:function(){return this.enabled&&(this.enabled=!1,this.unbind(),z.remove(this.container,this.config.classes.container),this.emit("selectable.disable")),this.enabled},destroy:function(){this.disable(),this.listeners=!1,this.remove(this.items)}},D});