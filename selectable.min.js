/*!
 *
 * Selectable
 * Copyright (c) 2017 Karl Saunders (http://mobius.ovh)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 0.13.2
 *
 */
(function(a,f){var g="Selectable";"object"==typeof exports?module.exports=f(g):"function"==typeof define&&define.amd?define([],f):a[g]=f(g)})("undefined"==typeof global?this.window||this.global:global,function(){"use strict";var f="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,g="classList"in document.documentElement,j=function(D,E,F){D.addEventListener(E,F,!1)},k=function(D,E,F){D.removeEventListener(E,F)},l=function(D,E){return D&&D!==document.documentElement&&(E(D)?D:l(D.parentNode,E))},m=function(D){return"[object Object]"===Object.prototype.toString.call(D)},p=function(D){return Array.isArray(D)||D instanceof HTMLCollection||D instanceof NodeList},q=function(D,E){for(var F in E)if(E.hasOwnProperty(F)){var G=E[F];G&&m(G)?(D[F]=D[F]||{},q(D[F],G)):D[F]=G}return D},t=function(D,E){var F=D.style;if(D){if(void 0===E)return window.getComputedStyle(D);if(m(E))for(var G in E)G in F||(G="-webkit-"+G),D.style[G]=E[G]+("string"==typeof E[G]?"":"opacity"==G?"":"px")}},u=function(D){var E=window,F=D.getBoundingClientRect(),G=document.documentElement||document.body.parentNode||document.body,H=void 0===E.pageXOffset?G.scrollLeft:E.pageXOffset,I=void 0===E.pageYOffset?G.scrollTop:E.pageYOffset;return{x1:F.left+H,x2:F.left+F.width+H,y1:F.top+I,y2:F.top+F.height+I,height:F.height,width:F.width}},v=function(D,E,F){var G;return function(){if(F=F||this,!G)return D.apply(F,arguments),G=!0,setTimeout(function(){G=!1},E)}},z={add:function(D,E){g?D.classList.add(E):!z.contains(D,E)&&(D.className=D.className.trim()+" "+E)},remove:function(D,E){g?D.classList.remove(E):z.contains(D,E)&&(D.className=D.className.replace(new RegExp("(^|\\s)"+E.split(" ").join("|")+"(\\s|$)","gi")," "))},contains:function(D,E){if(D)return g?D.classList.contains(E):!!D.className&&!!D.className.match(new RegExp("(\\s|^)"+E+"(\\s|$)"))}},A=function(D){return!!D.ctrlKey||!!D.metaKey},B=function(D){return!!D.shiftKey},C=function(D){var E={toggle:!1,autoRefresh:!0,throttle:50,appendTo:document.body,filter:".ui-selectable",tolerance:"touch",autoScroll:{threshold:40,increment:20},ignore:!1,lasso:{border:"1px dotted #000",backgroundColor:"rgba(52, 152, 219, 0.2)"},classes:{lasso:"ui-lasso",selected:"ui-selected",container:"ui-container",selecting:"ui-selecting",selectable:"ui-selectable",unselecting:"ui-unselecting"}};this.version="0.13.2",this.config=q(E,D),this.init()};return C.prototype={init:function(){var D=this,E=this.config;this.autoscroll=m(E.autoScroll),this.lasso=!1,E.lasso&&m(E.lasso)&&(this.lasso=document.createElement("div"),this.lasso.className=E.classes.lasso,t(this.lasso,q({position:"absolute",opacity:0},E.lasso))),f&&(E.toggle=!1),this.events={start:this.start.bind(this),touchstart:this.touchstart.bind(this),drag:this.drag.bind(this),end:this.end.bind(this),keyup:this.keyup.bind(this),keydown:this.keydown.bind(this),recalculate:v(this.recalculate,E.throttle,this)},this.autoscroll&&(this.events.scroll=this.onScroll.bind(this)),this.setContainer(),this.update(),this.enable(),setTimeout(function(){D.emit("selectable.init")},10)},update:function(){var D=this.config.classes,E=z.contains,F=this.bodyContainer?window.pageXOffset:this.container.scrollLeft,G=this.bodyContainer?window.pageYOffset:this.container.scrollTop,H=this.container.scrollWidth,I=this.container.scrollHeight;this.rect=u(this.container),this.scroll={x:F,y:G,max:{x:H-this.container.clientWidth,y:I-this.container.clientHeight}},this.items=[];for(var K,J=0;J<this.nodes.length;J++)K=this.nodes[J],z.add(K,D.selectable),this.items[J]={node:K,rect:u(K),startselected:!1,selected:E(K,D.selected),selecting:E(K,D.selecting),unselecting:E(K,D.unselecting)};this.emit("selectable.update",this.items)},bind:function(){var D=this.events;f?(j(this.container,"touchstart",D.touchstart),j(document,"touchend",D.end),j(document,"touchcancel",D.end),!1!==this.lasso&&j(document,"touchmove",D.drag)):(j(this.container,"mousedown",D.start),j(document,"mouseup",D.end),j(document,"keydown",D.keydown),j(document,"keyup",D.keyup),!1!==this.lasso&&j(document,"mousemove",D.drag)),this.autoscroll&&j(this.bodyContainer?window:this.container,"scroll",D.scroll),j(window,"resize",D.recalculate),j(window,"scroll",D.recalculate)},unbind:function(){var D=this.events;k(this.container,"mousedown",D.start),k(document,"mousemove",D.drag),k(document,"mouseup",D.end),k(document,"keydown",D.keydown),k(document,"keyup",D.keyup),this.autoscroll&&k(this.bodyContainer?window:this.container,"scroll",D.scroll),k(this.container,"touchstart",D.start),k(document,"touchend",D.end),k(document,"touchcancel",D.end),k(document,"touchmove",D.drag),k(window,"resize",D.recalculate),k(window,"scroll",D.recalculate)},touchstart:function(D){k(this.container,"mousedown",this.events.start),this.start(D)},start:function(D){var J,E=this,F=this.config,G=D.target,H="touchstart"===D.type,I=window;if(this.container.contains(G)&&3!==D.which&&!(0<D.button)){if(this.config.ignore){var K=!1,L=this.config.ignore;Array.isArray(L)||(L=[L]);for(var N,M=0;M<L.length;M++)if(N=G.closest(L[M]),N){K=!0;break}if(K)return!1}var O=l(G,function(X){return X===E.container||z.contains(X,F.classes.selectable)});if(!O||F.disabled)return!1;if(-1===["INPUT","SELECT","BUTTON","TEXTAREA","OPTION"].indexOf(G.tagName)&&D.preventDefault(),this.dragging=!0,this.origin={x:(H?D.touches[0].pageX:D.pageX)+(this.bodyContainer?0:this.scroll.x),y:(H?D.touches[0].pageY:D.pageY)+(this.bodyContainer?0:this.scroll.y),scroll:{x:this.scroll.x,y:this.scroll.y}},this.lasso&&this.container.appendChild(this.lasso),O!==this.container&&z.add(O,F.classes.selecting),F.autoRefresh&&this.update(),B(D)&&this.startEl)for(var P=this.items,Q=this.getNodes().indexOf(O),R=this.getNodes().indexOf(this.startEl),S=Q<R?1:-1;(Q+=S)&&Q!==R;)P[Q].selecting=!0;for(var M=0;M<this.items.length;M++){var T=this.items[M],U=T.node,V=U===O;if(T.selected){T.startselected=!0;var W=!1;W=H||F.toggle||A(D)?V:!V&&!B(D),W&&(z.remove(U,F.classes.selected),T.selected=!1,z.add(U,F.classes.unselecting),T.unselecting=!0)}V&&(J=T)}this.startEl=O,this.emit("selectable.start",D,J)}},drag:function(D){var E=this.config;if(!(E.disabled||!this.dragging||B(D))){var F,G=window,H="touchmove"===D.type?D.touches[0]:D;this.current={x1:this.origin.x,y1:this.origin.y,x2:H.pageX+(this.bodyContainer?0:this.scroll.x),y2:H.pageY+(this.bodyContainer?0:this.scroll.y)},this.current.x1>this.current.x2&&(F=this.current.x2,this.current.x2=this.current.x1,this.current.x1=F),this.current.y1>this.current.y2&&(F=this.current.y2,this.current.y2=this.current.y1,this.current.y1=F);for(var I=0;I<this.items.length;I++)this.highlight(this.items[I],A(D));if(this.coords={x1:this.current.x1,x2:this.current.x2-this.current.x1,y1:this.current.y1,y2:this.current.y2-this.current.y1},this.container!==document.body&&(this.coords.x1-=this.rect.x1,this.coords.y1-=this.rect.y1),this.autoscroll){var E=this.config.autoScroll,J=0,K=0,L=H.pageX,M=H.pageY;this.bodyContainer&&(L-=this.scroll.x,M-=this.scroll.y),M>=this.rect.y2-E.threshold&&this.scroll.y<this.scroll.max.y?K=E.increment:M<=this.rect.y1+E.threshold&&0<this.scroll.y&&(K=-E.increment),L>=this.rect.x2-E.threshold&&this.scroll.x<this.scroll.max.x?J=E.increment:L<=this.rect.x1+E.threshold&&0<this.scroll.x&&(J=-E.increment),this.bodyContainer?window.scrollBy(J,K):(this.container.scrollTop+=K,this.container.scrollLeft+=J)}if(this.lasso){if(!this.bodyContainer){if(D.pageY>=this.rect.y2&&this.scroll.y>=this.scroll.max.y){const N=this.origin.y-this.rect.y1-this.scroll.y;this.coords.y1=this.origin.y-this.rect.y1,this.coords.y2=this.rect.y2-N-this.rect.y1-2}D.pageY<=this.rect.y1&&0>=this.scroll.y&&(this.coords.y1=0,this.coords.y2=this.origin.y-this.rect.y1)}t(this.lasso,{left:this.coords.x1,top:this.coords.y1,width:this.coords.x2,height:this.coords.y2,opacity:1})}this.emit("selectable.drag",D,this.coords)}},end:function(D){if(this.dragging){this.dragging=!1,this.stopY=!1;var H,E=this,F=E.config,G=D.target,I=[],J=[],K="touchend"===D.type?D.touches[0]||D.changedTouches[0]:D;this.lasso&&this.container.contains(this.lasso)&&this.container.removeChild(this.lasso),this.lasso&&(t(this.lasso,{opacity:0,left:0,width:0,top:0,height:0}),G=document.elementFromPoint(K.pageX,K.pageY)),H=l(G,function(N){return z.contains(N,F.classes.selectable)});for(var M,L=0;L<this.items.length;L++)M=this.items[L],F.toggle&&M.node===H&&M.node===E.startEl&&M.selecting&&M.startselected&&(M.unselecting=!0,M.selecting=!1),M.unselecting&&(J.push(M),this.unselect(M)),M.selecting&&(I.push(M),this.select(M));this.emit("selectable.end",D,I,J)}},keydown:function(D){if(this.cmdDown=A(D),this.shiftDown=B(D),this.cmdDown){var E=D.code||D.keyCode;(65==E||97==E)&&(D.preventDefault(),this.selectAll())}},keyup:function(D){this.cmdDown=A(D),this.shiftDown=B(D)},onScroll:function(){this.scroll.x=this.bodyContainer?window.pageXOffset:this.container.scrollLeft,this.scroll.y=this.bodyContainer?window.pageYOffset:this.container.scrollTop;for(var E=0;E<this.items.length;E++)this.items[E].rect=u(this.items[E].node)},highlight:function(D,E){var F=this.config,G=F.classes,H=D.node,I=D.rect,J=this.current,K=this.scroll,L=z,M=!1,N=K.x,O=K.y;this.bodyContainer&&(N=0,O=0),"touch"===F.tolerance?M=!(I.x1+N>J.x2||I.x2+N<J.x1||I.y1+O>J.y2||I.y2+O<J.y1):"fit"===F.tolerance&&(M=I.x1+N>J.x1&&I.x2+N<J.x2&&I.y1+O>J.y1&&I.y2+O<J.y2),M?(D.selected&&!F.toggle&&(L.remove(H,G.selected),D.selected=!1),D.unselecting&&(!F.toggle||F.toggle&&"drag"!==F.toggle)&&(L.remove(H,G.unselecting),D.unselecting=!1),!D.selecting&&(L.add(H,G.selecting),D.selecting=!0)):(D.selecting&&(E&&D.startselected?(L.remove(H,G.selecting),D.selecting=!1,L.add(H,G.selected),D.selected=!0):(L.remove(H,G.selecting),D.selecting=!1,D.startselected&&!F.toggle&&(L.add(H,G.unselecting),D.unselecting=!0))),H.selected&&!E&&!D.startselected&&(L.remove(H,G.selected),D.selected=!1,L.add(H,G.unselecting),D.unselecting=!0))},setContainer:function(D){var F,E=this.config;if(this.container&&(F=this.container,this.unbind()),D=D||E.appendTo,"string"==typeof D?this.container=document.querySelector(D):D instanceof Element&&D.nodeName&&(this.container=D),z.add(this.container,this.config.classes.container),F&&z.remove(F,this.config.classes.container),p(E.filter)?this.nodes=[].slice.call(E.filter):"string"==typeof E.filter&&(this.nodes=[].slice.call(this.container.querySelectorAll(E.filter))),this.autoscroll){var G=t(this.container);"static"===G.position&&this.container!==document.body&&t(this.container,{position:"relative"})}this.bodyContainer=this.container===document.body,this.bind()},select:function(D,E){if(p(D)){for(var F=0;F<D.length;F++)this.select(D[F]);return this.getSelectedItems()}if(D=this.get(D),D){if(this.config.toggle&&"drag"===this.config.toggle&&!E&&D.selected&&!this.cmdDown)return this.unselect(D);var G=D.node,H=this.config.classes;return z.remove(G,H.selecting),z.add(G,H.selected),D.selecting=!1,D.selected=!0,D.startselected=!0,this.emit("selectable.select",D),D}return!1},unselect:function(D){if(p(D)){for(var E=0;E<D.length;E++)this.unselect(D[E]);return this.getSelectedItems()}if(D=this.get(D),D){var F=D.node,G=this.config.classes;return D.selecting=!1,D.selected=!1,D.unselecting=!1,D.startselected=!1,z.remove(F,G.unselecting),z.remove(F,G.selecting),z.remove(F,G.selected),this.emit("selectable.unselect",D),D}return!1},add:function(D){if(p(D))for(var E=0;E<D.length;E++)0>this.nodes.indexOf(D[E])&&D[E]instanceof Element&&this.nodes.push(D[E]);else 0>this.nodes.indexOf(D)&&D instanceof Element&&this.nodes.push(D);this.update()},remove:function(D,E){if(D=this.get(D),D){if(p(D))for(var F=D.length-1;0<=F;F--)this.remove(D[F],0<F);else{var G=D.node,H=this.config.classes,I=z.remove;I(G,H.selectable),I(G,H.unselecting),I(G,H.selecting),I(G,H.selected),this.nodes.splice(this.nodes.indexOf(D.node),1)}return E||this.update(),!0}return!1},recalculate:function(){for(var D=0;D<this.nodes.length;D++)this.items[D].rect=u(this.nodes[D]);this.emit("selectable.recalculate")},selectAll:function(){for(var D=0;D<this.items.length;D++)this.select(this.items[D],!0)},invert:function(){this.getItems();for(var F,E=0;E<this.items.length;E++)F=this.items[E],F.selected?this.unselect(F):this.select(F)},clear:function(){for(var D=this.items.length-1;0<=D;D--)this.unselect(this.items[D])},get:function(D){var E=!1;if(p(D)){E=[];for(var F=0;F<D.length;F++)F=this.get(F),F&&E.push(F)}else isNaN(D)?D instanceof Element?E=this.items[this.nodes.indexOf(D)]:m(D)&&0<=this.items.indexOf(D)&&(E=D):0<=this.items.indexOf(this.items[D])&&(E=this.items[D]);return E},getItems:function(){return this.items},getNodes:function(){return this.nodes},getSelectedItems:function(D){return this.getItems().filter(function(E){return D?!E.selected:E.selected})},getSelectedNodes:function(){return this.getSelectedItems().map(function(D){return D.node})},on:function(D,E){this.listeners=this.listeners||{},this.listeners[D]=this.listeners[D]||[],this.listeners[D].push(E)},off:function(D,E){this.listeners=this.listeners||{},!1==D in this.listeners||this.listeners[D].splice(this.listeners[D].indexOf(E),1)},emit:function(D){if(this.listeners=this.listeners||{},!1!=D in this.listeners)for(var E=0;E<this.listeners[D].length;E++)this.listeners[D][E].apply(this,Array.prototype.slice.call(arguments,1))},enable:function(){return this.enabled||(this.enabled=!0,this.bind(),z.add(this.container,this.config.classes.container),this.emit("selectable.enable")),this.enabled},disable:function(){return this.enabled&&(this.enabled=!1,this.unbind(),z.remove(this.container,this.config.classes.container),this.emit("selectable.disable")),this.enabled},destroy:function(){this.disable(),this.listeners=!1,this.remove(this.items)}},C});