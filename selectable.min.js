/*!
 *
 * Selectable
 * Copyright (c) 2017 Karl Saunders (http://mobius.ovh)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 0.11.0
 *
 */
(function(a,f){var g="Selectable";"object"==typeof exports?module.exports=f(g):"function"==typeof define&&define.amd?define([],f):a[g]=f(g)})("undefined"==typeof global?this.window||this.global:global,function(){"use strict";function a(G){var H={toggle:!1,autoRefresh:!0,throttle:50,appendTo:document.body,filter:".ui-selectable",tolerance:"touch",autoScroll:{offset:40,increment:10},ignore:!1,lasso:{border:"1px dotted #000",backgroundColor:"rgba(52, 152, 219, 0.2)"},classes:{lasso:"ui-lasso",selected:"ui-selected",container:"ui-container",selecting:"ui-selecting",selectable:"ui-selectable",unselecting:"ui-unselecting"}};this.version="0.11.0",this.config=u(H,G),this.init()}var g="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,j="classList"in document.documentElement,k=function(G,H,I){G.addEventListener(H,I,!1)},m=function(G,H,I){G.removeEventListener(H,I)},p=function(G,H){return G&&G!==document.documentElement&&(H(G)?G:p(G.parentNode,H))},q=function(G){return"[object Object]"===Object.prototype.toString.call(G)},s=function(G){return Array.isArray(G)||G instanceof HTMLCollection||G instanceof NodeList},u=function(G,H){for(var I in H)if(H.hasOwnProperty(I)){var J=H[I];J&&q(J)?(G[I]=G[I]||{},u(G[I],J)):G[I]=J}return G},v=function(G,H,I){if(q(G))for(var J in G)Object.prototype.hasOwnProperty.call(G,J)&&H.call(I,G[J],J);else for(J=0;J<G.length;J++)H.call(I,G[J],J)},z=function(G,H){var I=G.style;if(G){if(void 0===H)return window.getComputedStyle(G);q(H)&&v(H,function(J,K){K in I||(K="-webkit-"+K),G.style[K]=J+("string"==typeof J?"":"opacity"===K?"":"px")})}},A=function(G){var H=window,I=G.getBoundingClientRect(),J=document.documentElement||document.body.parentNode||document.body,K=void 0===H.pageXOffset?J.scrollLeft:H.pageXOffset,L=void 0===H.pageYOffset?J.scrollTop:H.pageYOffset;return{x1:I.left+K,x2:I.left+I.width+K,y1:I.top+L,y2:I.top+I.height+L,height:I.height,width:I.width}},B=function(G,H,I){var J;return function(){if(I=I||this,!J)return G.apply(I,arguments),J=!0,setTimeout(function(){J=!1},H)}},C={add:function(G,H){j?G.classList.add(H):!C.contains(G,H)&&(G.className=G.className.trim()+" "+H)},remove:function(G,H){j?G.classList.remove(H):C.contains(G,H)&&(G.className=G.className.replace(new RegExp("(^|\\s)"+H.split(" ").join("|")+"(\\s|$)","gi")," "))},contains:function(G,H){if(G)return j?G.classList.contains(H):!!G.className&&!!G.className.match(new RegExp("(\\s|^)"+H+"(\\s|$)"))}},D=function(G,H){Array.isArray(H)||(H=[H]);for(var I=-1<H.indexOf(G.nodeName.toLowerCase()),J=!1,K=0;K<H.length;K++)if("."==H[K].charAt(0)&&C.contains(G,H[K].substring(1))){J=!0;break}return I||J},E=function(G){return!!G.ctrlKey||!!G.metaKey},F=function(G){return!!G.shiftKey};return a.prototype={init:function(){var G=this,H=this.config;this.autoscroll=q(H.autoScroll),this.data={x:0,y:0,right:0,left:0,down:0,up:0},this.lasso=!1,H.lasso&&q(H.lasso)&&(this.lasso=document.createElement("div"),this.lasso.className=H.classes.lasso,z(this.lasso,u({position:"fixed",opacity:0},H.lasso))),g&&(H.toggle=!1),this.events={start:this.start.bind(this),touchstart:this.touchstart.bind(this),drag:this.drag.bind(this),end:this.end.bind(this),keyup:this.keyup.bind(this),keydown:this.keydown.bind(this),recalculate:B(this.recalculate,H.throttle,this)},this.autoscroll&&(this.events.scroll=B(this.scroll,H.throttle,this)),this.setContainer(),this.update(),this.enable(),setTimeout(function(){G.emit("selectable.init")},10)},update:function(){var G=this.config.classes,H=C.contains;this.size={rect:A(this.container),x:this.container.scrollLeft,y:this.container.scrollTop,w:this.container.scrollWidth,h:this.container.scrollHeight},this.items=[],v(this.nodes,function(I,J){C.add(I,G.selectable),this.items[J]={node:I,rect:A(I),startselected:!1,selected:H(I,G.selected),selecting:H(I,G.selecting),unselecting:H(I,G.unselecting)}},this),this.emit("selectable.update",this.items)},bind:function(){var G=this.events;g?(k(this.container,"touchstart",G.touchstart),k(document,"touchend",G.end),k(document,"touchcancel",G.end),!1!==this.lasso&&k(document,"touchmove",G.drag)):(k(this.container,"mousedown",G.start),k(document,"mouseup",G.end),k(document,"keydown",G.keydown),k(document,"keyup",G.keyup),!1!==this.lasso&&k(document,"mousemove",G.drag)),this.autoscroll&&k(this.container,"scroll",G.scroll),k(window,"resize",G.recalculate),k(window,"scroll",G.recalculate)},unbind:function(){var G=this.events;m(this.container,"mousedown",G.start),m(document,"mousemove",G.drag),m(document,"mouseup",G.end),m(document,"keydown",G.keydown),m(document,"keyup",G.keyup),this.autoscroll&&m(this.container,"scroll",G.scroll),m(this.container,"touchstart",G.start),m(document,"touchend",G.end),m(document,"touchcancel",G.end),m(document,"touchmove",G.drag),m(window,"resize",G.recalculate),m(window,"scroll",G.recalculate)},touchstart:function(G){m(this.container,"mousedown",this.events.start),this.start(G)},start:function(G){var H=G.target;if(this.container.contains(G.target)&&3!==G.which&&!(0<G.button)){if(this.config.ignore&&D(H,this.config.ignore))return!1;var K,I=this,J=this.config,L=p(G.target,function(R){return R===I.container||C.contains(R,J.classes.selectable)});if(!L||J.disabled)return!1;-1===["INPUT","SELECT","BUTTON","TEXTAREA","OPTION"].indexOf(G.target.tagName)&&G.preventDefault();var M="touchstart"===G.type;if(this.dragging=!0,this.origin={x:M?G.touches[0].pageX:G.pageX,y:M?G.touches[0].pageY:G.pageY},this.autoscroll&&(this.origin.scroll={x:this.container.scrollLeft,y:this.container.scrollTop}),this.lasso&&this.container.appendChild(this.lasso),L!==this.container&&C.add(L,J.classes.selecting),J.autoRefresh&&this.update(),F(G)&&this.startEl)for(var N=this.items,O=this.getNodes().indexOf(L),P=this.getNodes().indexOf(this.startEl),Q=O<P?1:-1;(O+=Q)&&O!==P;)N[O].selecting=!0;v(this.items,function(R){var S=R.node,T=S===L;if(R.selected){R.startselected=!0;var U=!1;U=M||J.toggle||E(G)?T:!T&&!F(G),U&&(C.remove(S,J.classes.selected),R.selected=!1,C.add(S,J.classes.unselecting),R.unselecting=!0)}T&&(K=R)}),this.startEl=L,this.emit("selectable.start",G,K)}},drag:function(G){var H=this.config;if(!(H.disabled||!this.dragging||F(G))){var J,K,I=this,L="touchmove"===G.type;this.offset=J={x1:this.origin.x,y1:this.origin.y,x2:L?G.touches[0].pageX:G.pageX,y2:L?G.touches[0].pageY:G.pageY,scroll:{x:0,y:0}},this.autoscroll&&(J.scroll={x:this.container.scrollLeft,y:this.container.scrollTop},this.scrolling={x:0,y:0},this.autoScroll(G)),J.x1>J.x2&&(K=J.x2,J.x2=J.x1,J.x1=K),J.y1>J.y2&&(K=J.y2,J.y2=J.y1,J.y1=K),v(this.items,function(N){I.highlight(N,E(G))});var M={x1:J.x1+this.data.right,x2:J.x2+this.data.left-(J.x1+this.data.right),y1:J.y1+this.data.down,y2:J.y2+this.data.up-(J.y1+this.data.down)};this.lasso&&this.updateHelper(M),this.emit("selectable.drag",G,M)}},end:function(G){if(this.dragging){this.dragging=!1;var K,H=this,I=H.config,J=G.target,L=[],M=[],N="touchend"===G.type?G.touches[0]||G.changedTouches[0]:G;this.lasso&&this.container.contains(this.lasso)&&this.container.removeChild(this.lasso),this.lasso&&(z(this.lasso,{opacity:0,left:0,width:0,top:0,height:0}),J=document.elementFromPoint(N.pageX,N.pageY)),K=p(J,function(O){return C.contains(O,I.classes.selectable)}),this.data.right=0,this.data.left=0,this.data.down=0,this.data.up=0,v(this.items,function(O){I.toggle&&O.node===K&&O.node===H.startEl&&O.selecting&&O.startselected&&(O.unselecting=!0,O.selecting=!1),O.unselecting&&(M.push(O),this.unselect(O)),O.selecting&&(L.push(O),this.select(O))},this),this.emit("selectable.end",G,L,M)}},keydown:function(G){if(this.cmdDown=E(G),this.shiftDown=F(G),this.cmdDown){var H=G.code||G.keyCode;(65==H||97==H)&&(G.preventDefault(),this.selectAll())}},keyup:function(G){this.cmdDown=E(G),this.shiftDown=F(G)},scroll:function(){v(this.items,function(H){H.rect=A(H.node)})},updateHelper:function(G){var H={opacity:1,left:G.x1,width:G.x2,top:G.y1,height:G.y2};this.autoscroll&&(H=u(H,{zIndex:0,position:"absolute",left:G.x1-this.size.rect.x1+this.offset.scroll.x,top:G.y1-this.size.rect.y1+this.offset.scroll.y})),z(this.lasso,H)},autoScroll:function(G){var H=this.config.autoScroll,I=this.size.rect,J=this.offset.scroll.x,K=this.offset.scroll.y,L=this.size.w,M=this.size.h,N=0,O=0,P=J,Q=K;(0<K||K<M-I.height)&&(G.pageY>=I.y2-H.offset||G.pageY<=I.y1+H.offset)&&(G.pageY>=I.y2-H.offset?(O=H.increment,this.scrolling.y=1):G.pageY<=I.y1+H.offset&&(O=-H.increment,this.scrolling.y=-1),Q+=O,this.container.scrollTop=this.offset.scroll.y=Q),(0<J||J<L-I.width)&&(G.pageX>=I.x2-H.offset||G.pageX<=I.x1+H.offset)&&(G.pageX>=I.x2-H.offset?(N=H.increment,this.scrolling.x=1):G.pageX<=I.x1+H.offset&&(N=-H.increment,this.scrolling.x=-1),P+=N,this.container.scrollLeft=this.offset.scroll.x=P),this.data.x=this.origin.scroll.x-this.offset.scroll.x,this.data.y=this.origin.scroll.y-this.offset.scroll.y,0<this.scrolling.x?this.data.right=this.data.x:0>this.scrolling.x&&(this.data.left=this.data.x),0<this.scrolling.y?this.data.down=this.data.y:0>this.scrolling.y&&(this.data.up=this.data.y)},highlight:function(G,H){var I=this.offset,J=this.config,K=J.classes,L=G.node,M=G.rect,N=this.data,O=!1;"touch"==J.tolerance?O=!(M.x1>I.x2+N.left||M.x2<I.x1+N.right||M.y1>I.y2+N.up||M.y2<I.y1+N.down):"fit"==J.tolerance&&(O=M.x1>I.x1+N.right&&M.x2<I.x2+N.left&&M.y1>I.y1+N.down&&M.y2<I.y2+N.up),O?(G.selected&&!J.toggle&&(C.remove(L,K.selected),G.selected=!1),G.unselecting&&(!J.toggle||J.toggle&&"drag"!==J.toggle)&&(C.remove(L,K.unselecting),G.unselecting=!1),!G.selecting&&(C.add(L,K.selecting),G.selecting=!0)):(G.selecting&&(H&&G.startselected?(C.remove(L,K.selecting),G.selecting=!1,C.add(L,K.selected),G.selected=!0):(C.remove(L,K.selecting),G.selecting=!1,G.startselected&&!J.toggle&&(C.add(L,K.unselecting),G.unselecting=!0))),L.selected&&!H&&!G.startselected&&(C.remove(L,K.selected),G.selected=!1,C.add(L,K.unselecting),G.unselecting=!0))},setContainer:function(G){var I,H=this.config;if(this.container&&(I=this.container,this.unbind()),G=G||H.appendTo,"string"==typeof G?this.container=document.querySelector(G):G instanceof Element&&G.nodeName&&(this.container=G),C.add(this.container,this.config.classes.container),I&&C.remove(I,this.config.classes.container),s(H.filter)?this.nodes=[].slice.call(H.filter):"string"==typeof H.filter&&(this.nodes=[].slice.call(this.container.querySelectorAll(H.filter))),this.autoscroll){var J=z(this.container);"static"===J.position&&z(this.container,{position:"relative"})}this.bind()},select:function(G,H){if(s(G))return v(G,function(K){this.select(K)},this),this.getSelectedItems();if(G=this.get(G),G){if(this.config.toggle&&"drag"===this.config.toggle&&!H&&G.selected&&!this.cmdDown)return this.unselect(G);var I=G.node,J=this.config.classes;return C.remove(I,J.selecting),C.add(I,J.selected),G.selecting=!1,G.selected=!0,G.startselected=!0,this.emit("selectable.select",G),G}return!1},unselect:function(G){if(s(G))return v(G,function(J){this.unselect(J)},this),this.getSelectedItems();if(G=this.get(G),G){var H=G.node,I=this.config.classes;return G.selecting=!1,G.selected=!1,G.unselecting=!1,G.startselected=!1,C.remove(H,I.unselecting),C.remove(H,I.selecting),C.remove(H,I.selected),this.emit("selectable.unselect",G),G}return!1},add:function(G){s(G)?v(G,function(H){0>this.nodes.indexOf(H)&&H instanceof Element&&this.nodes.push(H)},this):0>this.nodes.indexOf(G)&&G instanceof Element&&this.nodes.push(G),this.update()},remove:function(G,H){if(G=this.get(G),G){if(s(G))for(var I=G.length-1;0<=I;I--)this.remove(G[I],0<I);else{var J=G.node,K=this.config.classes,L=C.remove;L(J,K.selectable),L(J,K.unselecting),L(J,K.selecting),L(J,K.selected),this.nodes.splice(this.nodes.indexOf(G.node),1)}return H||this.update(),!0}return!1},recalculate:function(){v(this.nodes,function(G,H){this.items[H].rect=A(G)},this),this.emit("selectable.recalculate")},selectAll:function(){v(this.items,function(G){this.select(G,!0)},this)},clear:function(){for(var G=this.items.length-1;0<=G;G--)this.unselect(this.items[G])},get:function(G){var H=!1;return s(G)?(H=[],v(G,function(I){I=this.get(I),I&&H.push(I)},this)):isNaN(G)?G instanceof Element?H=this.items[this.nodes.indexOf(G)]:q(G)&&0<=this.items.indexOf(G)&&(H=G):0<=this.items.indexOf(this.items[G])&&(H=this.items[G]),H},getItems:function(){return this.items},getNodes:function(){return this.nodes},getSelectedItems:function(){return this.getItems().filter(function(G){return G.selected})},getSelectedNodes:function(){return this.getSelectedItems().map(function(G){return G.node})},on:function(G,H){this.listeners=this.listeners||{},this.listeners[G]=this.listeners[G]||[],this.listeners[G].push(H)},off:function(G,H){this.listeners=this.listeners||{},!1==G in this.listeners||this.listeners[G].splice(this.listeners[G].indexOf(H),1)},emit:function(G){if(this.listeners=this.listeners||{},!1!=G in this.listeners)for(var H=0;H<this.listeners[G].length;H++)this.listeners[G][H].apply(this,Array.prototype.slice.call(arguments,1))},enable:function(){return this.enabled||(this.enabled=!0,this.bind(),C.add(this.container,this.config.classes.container),this.emit("selectable.enable")),this.enabled},disable:function(){return this.enabled&&(this.enabled=!1,this.unbind(),C.remove(this.container,this.config.classes.container),this.emit("selectable.disable")),this.enabled},destroy:function(){this.disable(),this.listeners=!1,this.remove(this.items)}},a});