/*!
 *
 * Selectable
 * Copyright (c) 2017 Karl Saunders (http://mobius.ovh)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 0.13.3
 *
 */
(function(a,f){var g="Selectable";"object"==typeof exports?module.exports=f(g):"function"==typeof define&&define.amd?define([],f):a[g]=f(g)})("undefined"==typeof global?this.window||this.global:global,function(){"use strict";var f="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,g="classList"in document.documentElement,j=function(B,C){return B&&B!==document.documentElement&&(C(B)?B:j(B.parentNode,C))},k=function(B){return"[object Object]"===Object.prototype.toString.call(B)},l=function(B){return Array.isArray(B)||B instanceof HTMLCollection||B instanceof NodeList},m=function(B,C){for(var D in C)if(C.hasOwnProperty(D)){var E=C[D];E&&k(E)?(B[D]=B[D]||{},m(B[D],E)):B[D]=E}return B},p=function(B,C){var D=B.style;if(B){if(void 0===C)return window.getComputedStyle(B);if(k(C))for(var E in C)E in D||(E="-webkit-"+E),B.style[E]=C[E]+("string"==typeof C[E]?"":"opacity"==E?"":"px")}},q=function(B){var C=window,D=B.getBoundingClientRect(),E=document.documentElement||document.body.parentNode||document.body,F=void 0===C.pageXOffset?E.scrollLeft:C.pageXOffset,G=void 0===C.pageYOffset?E.scrollTop:C.pageYOffset;return{x1:D.left+F,x2:D.left+D.width+F,y1:D.top+G,y2:D.top+D.height+G,height:D.height,width:D.width}},t=function(B,C,D){var E;return function(){if(D=D||this,!E)return B.apply(D,arguments),E=!0,setTimeout(function(){E=!1},C)}},u={add:function(B,C){g?B.classList.add(C):!u.contains(B,C)&&(B.className=B.className.trim()+" "+C)},remove:function(B,C){g?B.classList.remove(C):u.contains(B,C)&&(B.className=B.className.replace(new RegExp("(^|\\s)"+C.split(" ").join("|")+"(\\s|$)","gi")," "))},contains:function(B,C){if(B)return g?B.classList.contains(C):!!B.className&&!!B.className.match(new RegExp("(\\s|^)"+C+"(\\s|$)"))}},v=function(B){return!!B.ctrlKey||!!B.metaKey},z=function(B){return!!B.shiftKey},A=function(B){var C={filter:".ui-selectable",tolerance:"touch",appendTo:document.body,toggle:!1,autoRefresh:!0,throttle:50,autoScroll:{threshold:0,increment:20},ignore:!1,lasso:{border:"1px dotted #000",backgroundColor:"rgba(52, 152, 219, 0.2)"},keys:["shiftKey","ctrlKey","metaKey"],classes:{lasso:"ui-lasso",selected:"ui-selected",container:"ui-container",selecting:"ui-selecting",selectable:"ui-selectable",unselecting:"ui-unselecting"}};this.version="0.13.3",this.config=m(C,B),this.init()};return A.prototype={init:function(){var B=this,C=this.config;this.autoscroll=k(C.autoScroll),this.lasso=!1,C.lasso&&k(C.lasso)&&(this.lasso=document.createElement("div"),this.lasso.className=C.classes.lasso,p(this.lasso,m({position:"absolute",opacity:0},C.lasso))),f&&(C.toggle=!1),this.events={start:this.start.bind(this),touchstart:this.touchstart.bind(this),drag:this.drag.bind(this),end:this.end.bind(this),keyup:this.keyup.bind(this),keydown:this.keydown.bind(this),recalculate:t(this.recalculate,C.throttle,this)},this.autoscroll&&(this.events.scroll=this.onScroll.bind(this)),this.setContainer(),this.update(),this.enable(),setTimeout(function(){B.emit("selectable.init")},10)},update:function(){var B=this.config.classes,C=u.contains,D=this.bodyContainer?window.pageXOffset:this.container.scrollLeft,E=this.bodyContainer?window.pageYOffset:this.container.scrollTop,F=this.container.scrollWidth,G=this.container.scrollHeight;this.rect=q(this.container),this.scroll={x:D,y:E,max:{x:F-this.container.clientWidth,y:G-this.container.clientHeight}},this.items=[];for(var I,H=0;H<this.nodes.length;H++)I=this.nodes[H],u.add(I,B.selectable),this.items[H]={node:I,rect:q(I),startselected:!1,selected:C(I,B.selected),selecting:C(I,B.selecting),unselecting:C(I,B.unselecting)};this.emit("selectable.update",this.items)},on:function(B,C){"string"==typeof B?(this.listeners=this.listeners||{},this.listeners[B]=this.listeners[B]||[],this.listeners[B].push(C)):arguments[0].addEventListener(arguments[1],arguments[2],!1)},off:function(B,C){if("string"==typeof B){if(this.listeners=this.listeners||{},!1==B in this.listeners)return;this.listeners[B].splice(this.listeners[B].indexOf(C),1)}else arguments[0].removeEventListener(arguments[1],arguments[2])},emit:function(B){if(this.listeners=this.listeners||{},!1!=B in this.listeners)for(var C=0;C<this.listeners[B].length;C++)this.listeners[B][C].apply(this,Array.prototype.slice.call(arguments,1))},bind:function(){var B=this.events;this.unbind(),f?(this.on(this.container,"touchstart",B.touchstart),this.on(document,"touchend",B.end),this.on(document,"touchcancel",B.end),!1!==this.lasso&&this.on(document,"touchmove",B.drag)):(this.on(this.container,"mousedown",B.start),this.on(document,"mouseup",B.end),this.on(document,"keydown",B.keydown),this.on(document,"keyup",B.keyup),!1!==this.lasso&&this.on(document,"mousemove",B.drag)),this.autoscroll&&this.on(this.bodyContainer?window:this.container,"scroll",B.scroll),this.on(window,"resize",B.recalculate),this.on(window,"scroll",B.recalculate)},unbind:function(){var B=this.events;this.off(this.container,"mousedown",B.start),this.off(document,"mousemove",B.drag),this.off(document,"mouseup",B.end),this.off(document,"keydown",B.keydown),this.off(document,"keyup",B.keyup),this.autoscroll&&this.off(this.bodyContainer?window:this.container,"scroll",B.scroll),this.off(this.container,"touchstart",B.start),this.off(document,"touchend",B.end),this.off(document,"touchcancel",B.end),this.off(document,"touchmove",B.drag),this.off(window,"resize",B.recalculate),this.off(window,"scroll",B.recalculate)},touchstart:function(B){this.off(this.container,"mousedown",this.events.start),this.start(B)},start:function(B){var H,C=this,D=this.config,E=B.target,F="touchstart"===B.type,G=window;if(this.container.contains(E)&&3!==B.which&&!(0<B.button)){if(this.config.ignore){var I=!1,J=this.config.ignore;Array.isArray(J)||(J=[J]);for(var L,K=0;K<J.length;K++)if(L=E.closest(J[K]),L){I=!0;break}if(I)return!1}var M=j(E,function(V){return V===C.container||u.contains(V,D.classes.selectable)});if(!M||D.disabled)return!1;if(-1===["INPUT","SELECT","BUTTON","TEXTAREA","OPTION"].indexOf(E.tagName)&&B.preventDefault(),this.dragging=!0,this.origin={x:(F?B.touches[0].pageX:B.pageX)+(this.bodyContainer?0:this.scroll.x),y:(F?B.touches[0].pageY:B.pageY)+(this.bodyContainer?0:this.scroll.y),scroll:{x:this.scroll.x,y:this.scroll.y}},this.lasso&&this.container.appendChild(this.lasso),M!==this.container&&u.add(M,D.classes.selecting),D.autoRefresh&&this.update(),this.canShift&&z(B)&&this.startEl)for(var N=this.items,O=this.getNodes().indexOf(M),P=this.getNodes().indexOf(this.startEl),Q=O<P?1:-1;(O+=Q)&&O!==P;)N[O].selecting=!0;for(var K=0;K<this.items.length;K++){var R=this.items[K],S=R.node,T=S===M;if(R.selected){R.startselected=!0;var U=!1;U=F||D.toggle||v(B)&&(this.canCtrl||this.canMeta)?T:!T&&!(z(B)&&this.canShift),U&&(u.remove(S,D.classes.selected),R.selected=!1,u.add(S,D.classes.unselecting),R.unselecting=!0)}T&&(H=R)}this.startEl=M,this.emit("selectable.start",B,H)}},drag:function(B){var C=this.config;if(!(C.disabled||!this.dragging||z(B)&&this.canShift)){var D,E=window,F="touchmove"===B.type?B.touches[0]:B;this.current={x1:this.origin.x,y1:this.origin.y,x2:F.pageX+(this.bodyContainer?0:this.scroll.x),y2:F.pageY+(this.bodyContainer?0:this.scroll.y)},this.current.x1>this.current.x2&&(D=this.current.x2,this.current.x2=this.current.x1,this.current.x1=D),this.current.y1>this.current.y2&&(D=this.current.y2,this.current.y2=this.current.y1,this.current.y1=D);for(var G=0;G<this.items.length;G++)this.highlight(this.items[G],v(B)&&(this.canCtrl||this.canMeta));if(this.coords={x1:this.current.x1,x2:this.current.x2-this.current.x1,y1:this.current.y1,y2:this.current.y2-this.current.y1},this.bodyContainer||(this.coords.x1-=this.rect.x1,this.coords.y1-=this.rect.y1),this.autoscroll){var C=this.config.autoScroll,H=0,I=0,J=F.pageX,K=F.pageY,L=C.increment;this.bodyContainer&&(J-=this.scroll.x,K-=this.scroll.y),K>=this.rect.y2-C.threshold&&this.scroll.y<this.scroll.max.y?I=L:K<=this.rect.y1+C.threshold&&0<this.scroll.y&&(I=-L),J>=this.rect.x2-C.threshold&&this.scroll.x<this.scroll.max.x?H=L:J<=this.rect.x1+C.threshold&&0<this.scroll.x&&(H=-L),this.bodyContainer?window.scrollBy(H,I):(this.container.scrollTop+=I,this.container.scrollLeft+=H)}if(this.lasso){if(!this.bodyContainer){if(B.pageY>=this.rect.y2&&this.scroll.y>=this.scroll.max.y){const M=this.origin.y-this.rect.y1-this.scroll.y;this.coords.y1=this.origin.y-this.rect.y1,this.coords.y2=this.rect.y2-M-this.rect.y1-2}B.pageY<=this.rect.y1&&0>=this.scroll.y&&(this.coords.y1=0,this.coords.y2=this.origin.y-this.rect.y1)}p(this.lasso,{left:this.coords.x1,top:this.coords.y1,width:this.coords.x2,height:this.coords.y2,opacity:1})}this.emit("selectable.drag",B,this.coords)}},end:function(B){if(this.dragging){this.dragging=!1,this.stopY=!1;var F,C=this,D=C.config,E=B.target,G=[],H=[],I="touchend"===B.type?B.touches[0]||B.changedTouches[0]:B;this.lasso&&this.container.contains(this.lasso)&&this.container.removeChild(this.lasso),this.lasso&&(p(this.lasso,{opacity:0,left:0,width:0,top:0,height:0}),E=document.elementFromPoint(I.pageX,I.pageY)),F=j(E,function(L){return u.contains(L,D.classes.selectable)});for(var K,J=0;J<this.items.length;J++)K=this.items[J],D.toggle&&K.node===F&&K.node===C.startEl&&K.selecting&&K.startselected&&(K.unselecting=!0,K.selecting=!1),K.unselecting&&(H.push(K),this.unselect(K)),K.selecting&&(G.push(K),this.select(K));this.emit("selectable.end",B,G,H)}},keydown:function(B){this.config.keys;if(this.cmdDown=v(B)&&(this.canCtrl||this.canMeta),this.cmdDown){var D=B.code||B.keyCode;(65==D||97==D)&&(B.preventDefault(),this.selectAll())}},keyup:function(B){this.config.keys;this.cmdDown=v(B)&&(this.canCtrl||this.canMeta)},onScroll:function(){this.scroll.x=this.bodyContainer?window.pageXOffset:this.container.scrollLeft,this.scroll.y=this.bodyContainer?window.pageYOffset:this.container.scrollTop;for(var C=0;C<this.items.length;C++)this.items[C].rect=q(this.items[C].node)},highlight:function(B,C){var D=this.config,E=D.classes,F=B.node,G=B.rect,H=this.current,I=this.scroll,J=u,K=!1,L=I.x,M=I.y;this.bodyContainer&&(L=0,M=0),"touch"===D.tolerance?K=!(G.x1+L>H.x2||G.x2+L<H.x1||G.y1+M>H.y2||G.y2+M<H.y1):"fit"===D.tolerance&&(K=G.x1+L>H.x1&&G.x2+L<H.x2&&G.y1+M>H.y1&&G.y2+M<H.y2),K?(B.selected&&!D.toggle&&(J.remove(F,E.selected),B.selected=!1),B.unselecting&&(!D.toggle||D.toggle&&"drag"!==D.toggle)&&(J.remove(F,E.unselecting),B.unselecting=!1),!B.selecting&&(J.add(F,E.selecting),B.selecting=!0)):(B.selecting&&(C&&B.startselected?(J.remove(F,E.selecting),B.selecting=!1,J.add(F,E.selected),B.selected=!0):(J.remove(F,E.selecting),B.selecting=!1,B.startselected&&!D.toggle&&(J.add(F,E.unselecting),B.unselecting=!0))),F.selected&&!C&&!B.startselected&&(J.remove(F,E.selected),B.selected=!1,J.add(F,E.unselecting),B.unselecting=!0))},setContainer:function(B){var D,C=this.config;if(this.container&&(D=this.container,this.unbind()),B=B||C.appendTo,"string"==typeof B?this.container=document.querySelector(B):B instanceof Element&&B.nodeName&&(this.container=B),u.add(this.container,C.classes.container),D&&u.remove(D,C.classes.container),this.bodyContainer=this.container===document.body,l(C.filter)?this.nodes=[].slice.call(C.filter):"string"==typeof C.filter&&(this.nodes=[].slice.call(this.container.querySelectorAll(C.filter))),this.autoscroll){var E=p(this.container);"static"!==E.position||this.bodyContainer||(this.container.style.position="relative")}this.bind()},select:function(B,C){if(l(B)){for(var D=0;D<B.length;D++)this.select(B[D]);return this.getSelectedItems()}if(B=this.get(B),B){if(this.config.toggle&&"drag"===this.config.toggle&&!C&&B.selected&&!this.cmdDown)return this.unselect(B);var E=B.node,F=this.config.classes;return u.remove(E,F.selecting),u.add(E,F.selected),B.selecting=!1,B.selected=!0,B.startselected=!0,this.emit("selectable.select",B),B}return!1},unselect:function(B){if(l(B)){for(var C=0;C<B.length;C++)this.unselect(B[C]);return this.getSelectedItems()}if(B=this.get(B),B){var D=B.node,E=this.config.classes;return B.selecting=!1,B.selected=!1,B.unselecting=!1,B.startselected=!1,u.remove(D,E.unselecting),u.remove(D,E.selecting),u.remove(D,E.selected),this.emit("selectable.unselect",B),B}return!1},add:function(B){var C=this.nodes;if(l(B))for(var D=0;D<B.length;D++)0>C.indexOf(B[D])&&B[D]instanceof Element&&C.push(B[D]);else 0>C.indexOf(B)&&B instanceof Element&&C.push(B);this.update()},remove:function(B,C){if(B=this.get(B),B){if(l(B))for(var D=B.length-1;0<=D;D--)this.remove(B[D],0<D);else{var E=B.node,F=this.config.classes,G=u.remove;G(E,F.selectable),G(E,F.unselecting),G(E,F.selecting),G(E,F.selected),this.nodes.splice(this.nodes.indexOf(B.node),1)}return C||this.update(),!0}return!1},recalculate:function(){for(var B=0;B<this.nodes.length;B++)this.items[B].rect=q(this.nodes[B]);this.emit("selectable.recalculate")},selectAll:function(){for(var B=0;B<this.items.length;B++)this.select(this.items[B],!0)},invert:function(){this.getItems();for(var D,C=0;C<this.items.length;C++)D=this.items[C],D.selected?this.unselect(D):this.select(D)},clear:function(){for(var B=this.items.length-1;0<=B;B--)this.unselect(this.items[B])},get:function(B){var C=!1;if(l(B)){C=[];for(var E,D=0;D<B.length;D++)E=this.get(B[D]),E&&C.push(E)}else isNaN(B)?B instanceof Element?C=this.items[this.nodes.indexOf(B)]:k(B)&&0<=this.items.indexOf(B)&&(C=B):0<=this.items.indexOf(this.items[B])&&(C=this.items[B]);return C},getItems:function(){return this.items},getNodes:function(){return this.nodes},getSelectedItems:function(B){return this.getItems().filter(function(C){return B?!C.selected:C.selected})},getSelectedNodes:function(){return this.getSelectedItems().map(function(B){return B.node})},enable:function(){if(!this.enabled){var B=this.config.keys;this.enabled=!0,this.canShift=0<=B.indexOf("shiftKey"),this.canCtrl=0<=B.indexOf("ctrlKey"),this.canMeta=0<=B.indexOf("metaKey"),this.bind(),u.add(this.container,this.config.classes.container),this.emit("selectable.enable")}return this.enabled},disable:function(){if(this.enabled){this.config.keys;this.enabled=!1,this.unbind(),u.remove(this.container,this.config.classes.container),this.emit("selectable.disable")}return this.enabled},destroy:function(){this.disable(),this.listeners=!1,this.remove(this.items)}},A});