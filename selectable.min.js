/*
 Selectable
 Copyright (c) 2017 Karl Saunders (http://mobius.ovh)
 Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.

 Version: 0.15.1

*/
(function(q,g){"object"===typeof exports?module.exports=g("Selectable"):"function"===typeof define&&define.amd?define([],g):q.Selectable=g("Selectable")})("undefined"!==typeof global?global:this.window||this.global,function(){var q,g,f,u,E,F,G,H,z,A,B="classList"in document.documentElement,C=function(a,c){return a&&a!==document.documentElement&&(c(a)?a:C(a.parentNode,c))},v=function(a){return"[object Object]"===Object.prototype.toString.call(a)},l=function(a){return Array.isArray(a)||a instanceof
    HTMLCollection||a instanceof NodeList},D=function(a,c){for(var b in c)if(c.hasOwnProperty(b)){var d=c[b];d&&v(d)?(a[b]=a[b]||{},D(a[b],d)):a[b]=d}return a},x=function(a,c){var b=a.style;if(a){if(void 0===c)return window.getComputedStyle(a);if(v(c))for(var d in c)d in b||(d="-webkit-"+d),a.style[d]=c[d]+("string"===typeof c[d]?"":"opacity"===d?"":"px")}},y=function(a){var c=window;a=a.getBoundingClientRect();var b=document.documentElement||document.body.parentNode||document.body,d=void 0!==c.pageXOffset?
    c.pageXOffset:b.scrollLeft;c=void 0!==c.pageYOffset?c.pageYOffset:b.scrollTop;return{x1:a.left+d,x2:a.left+a.width+d,y1:a.top+c,y2:a.top+a.height+c,height:a.height,width:a.width}},J=function(a,c,b){var d;return function(){b=b||this;if(!d)return a.apply(b,arguments),d=!0,setTimeout(function(){d=!1},c)}},e={add:function(a,c){B?a.classList.add(c):e.contains(a,c)||(a.className=a.className.trim()+" "+c)},remove:function(a,c){B?a.classList.remove(c):e.contains(a,c)&&(a.className=a.className.replace(new RegExp("(^|\\s)"+
    c.split(" ").join("|")+"(\\s|$)","gi")," "))},contains:function(a,c){if(a)return B?a.classList.contains(c):!!a.className&&!!a.className.match(new RegExp("(\\s|^)"+c+"(\\s|$)"))}},w=function(a){return!!a.ctrlKey||!!a.metaKey},r=["x","y"],k={x:"x1",y:"y1"},t={x:"x2",y:"y2"},I=function(a){this.version="0.15.1";this.v=this.version.split(".").map(function(a){return parseInt(a,10)});u="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch;this.init(a)};I.prototype={init:function(a){var c=
    this,b=this,d=this.config=D({filter:".ui-selectable",tolerance:"touch",appendTo:document.body,toggle:!1,autoRefresh:!0,throttle:50,autoScroll:{threshold:0,increment:10},saveState:!1,ignore:!1,lasso:{border:"1px dotted #000",backgroundColor:"rgba(52, 152, 219, 0.2)"},keys:["shiftKey","ctrlKey","metaKey"],classes:{lasso:"ui-lasso",selected:"ui-selected",container:"ui-container",selecting:"ui-selecting",selectable:"ui-selectable",deselecting:"ui-deselecting"}},a);g=v(d.autoScroll);this.lasso=!1;d.lasso&&
    v(d.lasso)&&(this.lasso=document.createElement("div"),this.lasso.className=d.classes.lasso,x(this.lasso,D({position:"absolute",boxSizing:"border-box",opacity:0},d.lasso)));u&&(d.toggle=!1);this.events={};"_start _touchstart _drag _end _keyup _keydown _blur _focus".split(" ").forEach(function(a){c.events[a]=c[a].bind(c)});this.events._refresh=J(this.refresh,d.throttle,this);g&&(this.events._scroll=this._onScroll.bind(this));this.setContainer();l(d.filter)?this.nodes=[].slice.call(d.filter):"string"===
    typeof d.filter&&(this.nodes=[].slice.call(this.container.querySelectorAll(d.filter)));this.nodes.forEach(function(a){e.add(a,d.classes.selectable)});this.update();this.enable();setTimeout(function(){d.saveState&&b.state("save");b.emit(15>b.v[1]?"selectable.init":"init")},10)},update:function(){this._loadItems();this.refresh();this.emit(15>this.v[1]?"selectable.update":"update",this.items)},refresh:function(){var a=window.innerWidth,c=window.innerHeight,b=this.bodyContainer?window.pageXOffset:this.container.scrollLeft,
    d=this.bodyContainer?window.pageYOffset:this.container.scrollTop;F=this.container.offsetWidth;E=this.container.offsetHeight;H=this.container.clientWidth;G=this.container.clientHeight;A=this.container.scrollWidth;z=this.container.scrollHeight;this.rect=y(this.container);this.bodyContainer&&(this.rect.x2=a,this.rect.y2=c);f={x:b,y:d,max:{x:A-(this.bodyContainer?a:H),y:z-(this.bodyContainer?c:G)},size:{x:this.clientWidth,y:this.clientHeight},scrollable:{x:A>F,y:z>E}};console.log(f);for(a=0;a<this.nodes.length;a++)this.items[a].rect=
    y(this.nodes[a]);this.emit(15>this.v[1]?"selectable.refresh":"refresh")},bind:function(){var a=this.events;this.unbind();if(u){if(this.on(this.container,"touchstart",a._touchstart),this.on(document,"touchend",a._end),this.on(document,"touchcancel",a._end),!1!==this.lasso)this.on(document,"touchmove",a._drag)}else if(this.on(this.container,"mousedown",a._start),this.on(document,"mouseup",a._end),this.on(document,"keydown",a._keydown),this.on(document,"keyup",a._keyup),this.on(this.container,"mouseenter",
    a._focus),this.on(this.container,"mouseleave",a._blur),!1!==this.lasso)this.on(document,"mousemove",a._drag);if(g)this.on(this.bodyContainer?window:this.container,"scroll",a._scroll);this.on(window,"resize",a._refresh);this.on(window,"scroll",a._refresh)},unbind:function(){var a=this.events;this.off(this.container,"mousedown",a._start);this.off(document,"mousemove",a._drag);this.off(document,"mouseup",a._end);this.off(document,"keydown",a._keydown);this.off(document,"keyup",a._keyup);this.off(this.container,
    "mouseenter",a._focus);this.off(this.container,"mouseleave",a._blur);g&&this.off(this.bodyContainer?window:this.container,"scroll",a._scroll);this.off(this.container,"touchstart",a._start);this.off(document,"touchend",a._end);this.off(document,"touchcancel",a._end);this.off(document,"touchmove",a._drag);this.off(window,"resize",a._refresh);this.off(window,"scroll",a._refresh)},setContainer:function(a){var c=this.config;if(this.container){var b=this.container;this.unbind()}a=a||c.appendTo;"string"===
    typeof a?this.container=document.querySelector(a):a instanceof Element&&a.nodeName&&(this.container=a);e.add(this.container,c.classes.container);b&&e.remove(b,c.classes.container);this.bodyContainer=this.container===document.body;this._loadItems();g&&"static"===x(this.container).position&&!this.bodyContainer&&(this.container.style.position="relative");this.bind()},select:function(a,c){if(l(a)){for(var b=0;b<a.length;b++)this.select(a[b]);return this.getSelectedItems()}if(a=this.get(a)){if(this.config.toggle&&
    "drag"===this.config.toggle&&!c&&a.selected&&!this.cmdDown)return this.deselect(a);b=a.node;var d=this.config.classes;e.remove(b,d.selecting);e.add(b,d.selected);a.selecting=!1;a.selected=!0;a.startselected=!0;this.emit(15>this.v[1]?"selectable.select":"selecteditem",a);return a}return!1},deselect:function(a){if(l(a)){for(var c=0;c<a.length;c++)this.deselect(a[c]);return this.getSelectedItems()}if(a=this.get(a)){c=a.node;var b=this.config.classes;a.selecting=!1;a.selected=!1;a.deselecting=!1;a.startselected=
    !1;e.remove(c,b.deselecting);e.remove(c,b.selecting);e.remove(c,b.selected);this.emit(15>this.v[1]?"selectable.deselect":"deselecteditem",a);return a}return!1},toggle:function(a){if(a=this.get(a)){l(a)||(a=[a]);for(var c=0;c<a.length;c++)a[c].selected?this.deselect(a[c]):this.select(a[c])}},add:function(a){var c=[];l(a)||(a=[a]);for(var b=0;b<a.length;b++)0>this.nodes.indexOf(a[b])&&a[b]instanceof Element&&(c.push(a[b]),e.add(a[b],this.config.classes.selectable));this.nodes=this.nodes.concat(c);this.update();
    for(b=0;b<c.length;b++)this.emit("addeditem",this.get(c[b]))},remove:function(a,c){if(a=this.get(a)){if(l(a))for(var b=a.length-1;0<=b;b--)this.remove(a[b],0<b);else{b=a.node;var d=this.config.classes,p=e.remove;p(b,d.selectable);p(b,d.deselecting);p(b,d.selecting);p(b,d.selected);this.nodes.splice(this.nodes.indexOf(a.node),1);this.emit("removeditem",a)}c||this.update();return!0}return!1},selectAll:function(){for(var a=0;a<this.items.length;a++)this.select(this.items[a],!0)},invert:function(){this.getItems();
    for(var a=0;a<this.items.length;a++){var c=this.items[a];c.selected?this.deselect(c):this.select(c)}},clear:function(){for(var a=this.items.length-1;0<=a;a--)this.deselect(this.items[a])},get:function(a){var c=!1;if(l(a)){c=[];for(var b=0;b<a.length;b++){var d=this.get(a[b]);d&&c.push(d)}}else isNaN(a)?a instanceof Element?c=this.items[this.nodes.indexOf(a)]:v(a)&&0<=this.items.indexOf(a)&&(c=a):0<=this.items.indexOf(this.items[a])&&(c=this.items[a]);return c},getItems:function(){return this.items},
    getNodes:function(){return this.nodes},getSelectedItems:function(a){return this.getItems().filter(function(c){return a?!c.selected:c.selected})},getSelectedNodes:function(){return this.getSelectedItems().map(function(a){return a.node})},state:function(a){var c=!1,b=!1;switch(a){case "save":this.states=this.states||[];this.states.push(this.getSelectedNodes());b=this.config.saveState;b="isInteger"in Number?Number.isInteger(b):!isNaN(b);b&&this.states.length>this.config.saveState&&this.states.shift();
    this.currentState=this.states.length-1;b=!0;break;case "undo":0<this.currentState&&(this.currentState--,b=c=!0);break;case "redo":this.currentState<this.states.length-1&&(this.currentState++,b=c=!0);break;case "clear":this.states=[],this.currentState=!1}c&&(this.clear(),this.select(this.states[this.currentState]));b&&this.emit((15>this.v[1]?"selectable.state.":"state.")+a,this.states[this.currentState],this.states)},enable:function(){if(!this.enabled){var a=this.config.keys;this.enabled=!0;this.canShift=
    0<=a.indexOf("shiftKey");this.canCtrl=0<=a.indexOf("ctrlKey");this.canMeta=0<=a.indexOf("metaKey");this.bind();e.add(this.container,this.config.classes.container);this.emit(15>this.v[1]?"selectable.enable":"enabled")}return this.enabled},disable:function(){this.enabled&&(this.enabled=!1,this.unbind(),e.remove(this.container,this.config.classes.container),this.emit(15>this.v[1]?"selectable.disable":"disabled"));return this.enabled},destroy:function(){this.disable();this.listeners=!1;this.clear();this.state("clear");
    this.remove(this.items)},on:function(a,c,b){"string"===typeof a?(this.listeners=this.listeners||{},this.listeners[a]=this.listeners[a]||[],this.listeners[a].push(c)):a.addEventListener(c,b,!1)},off:function(a,c,b){"string"===typeof a?(this.listeners=this.listeners||{},!1!==a in this.listeners&&this.listeners[a].splice(this.listeners[a].indexOf(c),1)):a.removeEventListener(c,b)},emit:function(a){this.listeners=this.listeners||{};if(!1!==a in this.listeners)for(var c=0;c<this.listeners[a].length;c++)this.listeners[a][c].apply(this,
    Array.prototype.slice.call(arguments,1))},_touchstart:function(a){this.off(this.container,"mousedown",this.events.start);this.start(a)},_start:function(a){var c=this,b=this._getEvent(a),d=this.config,p,k=w(a)&&(this.canCtrl||this.canMeta),h=this.canShift&&!!a.shiftKey;if(!(!this.container.contains(a.target)||3===a.which||0<a.button||d.disabled)){if(f.scrollable.y&&b.pageX>this.rect.x1+f.size.x||f.scrollable.x&&b.pageY>this.rect.y1+f.size.y)return!1;if(this.config.ignore){var n=!1,m=this.config.ignore;
    Array.isArray(m)||(m=[m]);for(var g=0;g<m.length;g++)if(a.target.closest(m[g])){n=!0;break}if(n)return!1}n=C(a.target,function(a){return a===c.container||e.contains(a,d.classes.selectable)});if(!n)return!1;-1===["INPUT","SELECT","BUTTON","TEXTAREA","OPTION"].indexOf(a.target.tagName)&&a.preventDefault();this.dragging=!0;this.origin={x:b.pageX+(this.bodyContainer?0:f.x),y:b.pageY+(this.bodyContainer?0:f.y),scroll:{x:f.x,y:f.y}};this.lasso&&this.container.appendChild(this.lasso);n!==this.container&&
    (b=this.get(n),b.selecting=!0,e.add(n,d.classes.selecting));d.autoRefresh&&this.refresh();if(h&&q){g=this.items;b=this.getNodes().indexOf(n);m=this.getNodes().indexOf(q);for(var l=b<m?1:-1;(b+=l)&&b!==m;)g[b].selecting=!0}for(g=0;g<this.items.length;g++)b=this.items[g],m=b.node,l=m===n,b.selected&&(b.startselected=!0,(u||d.toggle||k?!l:l||h)||(e.remove(m,d.classes.selected),b.selected=!1,e.add(m,d.classes.deselecting),b.deselecting=!0)),l&&(p=b);q=n;this.emit(15>this.v[1]?"selectable.start":"start",
    a,p)}},_drag:function(a){if(!(this.config.disabled||!this.dragging||a.shiftKey&&this.canShift)){var c=this._getEvent(a);w(a);var b=this.origin;this.mouse={x:c.pageX,y:c.pageY};b=this.current={x1:b.x,y1:b.y,x2:this.mouse.x+(this.bodyContainer?0:f.x),y2:this.mouse.y+(this.bodyContainer?0:f.y)};for(var d=0;d<r.length;d++){var e=r[d];b[k[e]]>b[t[e]]&&(c=b[t[e]],b[t[e]]=b[k[e]],b[k[e]]=c)}for(d=0;d<this.items.length;d++)this._highlight(this.items[d],w(a)&&(this.canCtrl||this.canMeta));this.coords={x1:b.x1,
    x2:b.x2-b.x1,y1:b.y1,y2:b.y2-b.y1};g&&(this.bodyContainer||(this.coords.x1-=this.rect.x1,this.coords.y1-=this.rect.y1),this._autoScroll());this.lasso&&(this.bodyContainer||!g||this.config.autoScroll.lassoOverflow||this._limitLasso(),x(this.lasso,{left:this.coords.x1,top:this.coords.y1,width:this.coords.x2,height:this.coords.y2,opacity:1}));this.emit(15>this.v[1]?"selectable.drag":"drag",a,this.coords)}},_end:function(a){if(this.dragging){this.dragging=!1;var c=this.config,b=a.target,d=this._getEvent(a),
    f=[],g=[];this.lasso&&this.container.contains(this.lasso)&&this.container.removeChild(this.lasso);this.lasso&&(x(this.lasso,{opacity:0,left:0,width:0,top:0,height:0}),b=document.elementFromPoint(d.pageX,d.pageY),b||(b=this.container));b=C(b,function(a){return e.contains(a,c.classes.selectable)});for(d=0;d<this.items.length;d++){var h=this.items[d];c.toggle&&h.node===b&&h.node===q&&h.selecting&&h.startselected&&(h.deselecting=!0,h.selecting=!1);h.deselecting&&(g.push(h),this.deselect(h));h.selecting&&
    (f.push(h),this.select(h))}c.saveState&&this.state("save");this.emit(15>this.v[1]?"selectable.end":"end",a,f,g)}},_keydown:function(a){this.cmdDown=w(a)&&(this.canCtrl||this.canMeta);var c=!1;void 0!==a.key?c=a.key:void 0!==a.keyCode&&(c=a.keyCode);if(c)if(this.cmdDown&&this.focused)switch(a.preventDefault(),c){case 65:case "a":case "A":this.selectAll();break;case 89:case "y":case "Y":this.state("redo");break;case 90:case "z":case "Z":this.state("undo")}else switch(c){case 32:case " ":this.toggle(document.activeElement)}},
    _keyup:function(a){this.cmdDown=w(a)&&(this.canCtrl||this.canMeta)},_onScroll:function(a){f.x=this.bodyContainer?window.pageXOffset:this.container.scrollLeft;f.y=this.bodyContainer?window.pageYOffset:this.container.scrollTop;for(a=0;a<this.items.length;a++)this.items[a].rect=y(this.items[a].node)},_loadItems:function(){var a=this.config;this.nodes=[].slice.call(this.container.querySelectorAll("."+a.classes.selectable));this.items=[];if(this.nodes.length)for(var c=0;c<this.nodes.length;c++){var b=
    this.nodes[c];e.add(b,a.classes.selectable);this.items.push({node:b,rect:y(b),startselected:!1,selected:e.contains(b,a.classes.selected),selecting:e.contains(b,a.classes.selecting),deselecting:e.contains(b,a.classes.deselecting)})}},_getEvent:function(a){return u?"touchend"===a.type?a.changedTouches[0]:a.touches[0]:a},_autoScroll:function(){var a=this.config.autoScroll,c=a.increment;a=a.threshold;var b={x:0,y:0};this.bodyContainer&&(this.mouse.x-=f.x,this.mouse.y-=f.y);console.log(this.mouse.y,window.innerHeight-
    a,f.max.y);for(var d=0;d<r.length;d++){var e=r[d];this.mouse[e]>=this.rect[t[e]]-a&&f[e]<f.max[e]?b[e]=c:this.mouse[e]<=this.rect[k[e]]+a&&0<f[e]&&(b[e]=-c)}this.bodyContainer?(console.log(b),window.scrollBy(b.x,b.y)):(this.container.scrollTop+=b.y,this.container.scrollLeft+=b.x)},_limitLasso:function(){for(var a=0;a<r.length;a++){var c=r[a],b=this.rect[k[c]]+f.size[c];if(this.mouse[c]>=b&&f[c]>=f.max[c]){var d=origin[c]-this.rect[k[c]]-f[c];this.coords[k[c]]=origin[c]-this.rect[k[c]];this.coords[t[c]]=
    b-d-this.rect[k[c]]}this.mouse[c]<=this.rect[k[c]]&&0>=f[c]&&(this.coords[k[c]]=0,this.coords[t[c]]=origin[c]-this.rect[k[c]])}},_highlight:function(a,c){var b=this.config,d=a.node,g=!1,k=this.bodyContainer?0:f.x,h=this.bodyContainer?0:f.y;"touch"===b.tolerance?g=!(a.rect.x1+k>this.current.x2||a.rect.x2+k<this.current.x1||a.rect.y1+h>this.current.y2||a.rect.y2+h<this.current.y1):"fit"===b.tolerance&&(g=a.rect.x1+k>this.current.x1&&a.rect.x2+k<this.current.x2&&a.rect.y1+h>this.current.y1&&a.rect.y2+
    h<this.current.y2);g?(a.selected&&!b.toggle&&(e.remove(d,b.classes.selected),a.selected=!1),a.deselecting&&(!b.toggle||b.toggle&&"drag"!==b.toggle)&&(e.remove(d,b.classes.deselecting),a.deselecting=!1),a.selecting||(e.add(d,b.classes.selecting),a.selecting=!0)):(a.selecting&&(e.remove(d,b.classes.selecting),a.selecting=!1,c&&a.startselected?(e.add(d,b.classes.selected),a.selected=!0):a.startselected&&!b.toggle&&(e.add(d,b.classes.deselecting),a.deselecting=!0)),!d.selected||c||a.startselected||(e.remove(d,
    b.classes.selected),a.selected=!1,e.add(d,b.classes.deselecting),a.deselecting=!0))},_focus:function(a){this.focused=!0;e.add(this.container,"ui-focused")},_blur:function(a){this.focused=!1;e.remove(this.container,"ui-focused")}};return I});